import{e as lt}from"./events-5f626723.js";import{c as rt,g as zo,r as qo,f as Bo}from"./index-1576e133.js";import{e as Bi,c as Ki,s as Vi,a as Gi,d as ki,g as Ko,h as Vo,i as ks,j as An,b as Go,k as ko,l as Ys,f as Yi,m as Yo,J as wr,n as Wi,o as Ji,q as Ct,r as It,t as Ws,u as Xi,H as Jr}from"./index-fd491746.js";function Wo(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Jo=Xo;function Xo(t,e,r){var i=r&&r.stringify||Wo,n=1;if(typeof t=="object"&&t!==null){var h=e.length+n;if(h===1)return t;var E=new Array(h);E[0]=i(t);for(var f=1;f<h;f++)E[f]=i(e[f]);return E.join(" ")}if(typeof t!="string")return t;var _=e.length;if(_===0)return t;for(var O="",v=1-n,x=-1,$=t&&t.length||0,N=0;N<$;){if(t.charCodeAt(N)===37&&N+1<$){switch(x=x>-1?x:0,t.charCodeAt(N+1)){case 100:case 102:if(v>=_||e[v]==null)break;x<N&&(O+=t.slice(x,N)),O+=Number(e[v]),x=N+2,N++;break;case 105:if(v>=_||e[v]==null)break;x<N&&(O+=t.slice(x,N)),O+=Math.floor(Number(e[v])),x=N+2,N++;break;case 79:case 111:case 106:if(v>=_||e[v]===void 0)break;x<N&&(O+=t.slice(x,N));var A=typeof e[v];if(A==="string"){O+="'"+e[v]+"'",x=N+2,N++;break}if(A==="function"){O+=e[v].name||"<anonymous>",x=N+2,N++;break}O+=i(e[v]),x=N+2,N++;break;case 115:if(v>=_)break;x<N&&(O+=t.slice(x,N)),O+=String(e[v]),x=N+2,N++;break;case 37:x<N&&(O+=t.slice(x,N)),O+="%",x=N+2,N++,v--;break}++v}++N}return x===-1?t:(x<$&&(O+=t.slice(x)),O)}const Nn=Jo;var Er=vt;const _r=oc().console||{},Zo={mapHttpRequest:jr,mapHttpResponse:jr,wrapRequestSerializer:ui,wrapResponseSerializer:ui,wrapErrorSerializer:ui,req:jr,res:jr,err:ic};function Qo(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function vt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||_r;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=Qo(t.browser.serialize,i);let h=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(h=!1);const E=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const f=t.level||"info",_=Object.create(r);_.log||(_.log=br),Object.defineProperty(_,"levelVal",{get:v}),Object.defineProperty(_,"level",{get:x,set:$});const O={transmit:e,serialize:n,asObject:t.browser.asObject,levels:E,timestamp:nc(t)};_.levels=vt.levels,_.level=f,_.setMaxListeners=_.getMaxListeners=_.emit=_.addListener=_.on=_.prependListener=_.once=_.prependOnceListener=_.removeListener=_.removeAllListeners=_.listeners=_.listenerCount=_.eventNames=_.write=_.flush=br,_.serializers=i,_._serialize=n,_._stdErrSerialize=h,_.child=N,e&&(_._logEvent=Pi());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function x(){return this._level}function $(A){if(A!=="silent"&&!this.levels.values[A])throw Error("unknown level "+A);this._level=A,Yt(O,_,"error","log"),Yt(O,_,"fatal","error"),Yt(O,_,"warn","error"),Yt(O,_,"info","log"),Yt(O,_,"debug","log"),Yt(O,_,"trace","log")}function N(A,q){if(!A)throw new Error("missing bindings for child Pino");q=q||{},n&&A.serializers&&(q.serializers=A.serializers);const F=q.serializers;if(n&&F){var B=Object.assign({},i,F),u=t.browser.serialize===!0?Object.keys(B):n;delete A.serializers,Xr([A],u,B,this._stdErrSerialize)}function b(g){this._childLevel=(g._childLevel|0)+1,this.error=Wt(g,A,"error"),this.fatal=Wt(g,A,"fatal"),this.warn=Wt(g,A,"warn"),this.info=Wt(g,A,"info"),this.debug=Wt(g,A,"debug"),this.trace=Wt(g,A,"trace"),B&&(this.serializers=B,this._serialize=u),e&&(this._logEvent=Pi([].concat(g._logEvent.bindings,A)))}return b.prototype=this,new b(this)}return _}vt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};vt.stdSerializers=Zo;vt.stdTimeFunctions=Object.assign({},{nullTime:Js,epochTime:Xs,unixTime:sc,isoTime:ac});function Yt(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?br:n[r]?n[r]:_r[r]||_r[i]||br,ec(t,e,r)}function ec(t,e,r){!t.transmit&&e[r]===br||(e[r]=function(i){return function(){const h=t.timestamp(),E=new Array(arguments.length),f=Object.getPrototypeOf&&Object.getPrototypeOf(this)===_r?_r:this;for(var _=0;_<E.length;_++)E[_]=arguments[_];if(t.serialize&&!t.asObject&&Xr(E,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(f,tc(this,r,E,h)):i.apply(f,E),t.transmit){const O=t.transmit.level||e.level,v=vt.levels.values[O],x=vt.levels.values[r];if(x<v)return;rc(this,{ts:h,methodLevel:r,methodValue:x,transmitLevel:O,transmitValue:vt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},E)}}}(e[r]))}function tc(t,e,r,i){t._serialize&&Xr(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let h=n[0];const E={};i&&(E.time=i),E.level=vt.levels.values[e];let f=(t._childLevel|0)+1;if(f<1&&(f=1),h!==null&&typeof h=="object"){for(;f--&&typeof n[0]=="object";)Object.assign(E,n.shift());h=n.length?Nn(n.shift(),n):void 0}else typeof h=="string"&&(h=Nn(n.shift(),n));return h!==void 0&&(E.msg=h),E}function Xr(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=vt.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const h in t[n])e&&e.indexOf(h)>-1&&h in r&&(t[n][h]=r[h](t[n][h]))}function Wt(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function rc(t,e,r){const i=e.send,n=e.ts,h=e.methodLevel,E=e.methodValue,f=e.val,_=t._logEvent.bindings;Xr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(O){return _.indexOf(O)===-1}),t._logEvent.level.label=h,t._logEvent.level.value=E,i(h,t._logEvent,f),t._logEvent=Pi(_)}function Pi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function ic(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function nc(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Js:Xs}function jr(){return{}}function ui(t){return t}function br(){}function Js(){return!1}function Xs(){return Date.now()}function sc(){return Math.round(Date.now()/1e3)}function ac(){return new Date(Date.now()).toISOString()}function oc(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var Zr={},zr={},cc={get exports(){return zr},set exports(t){zr=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,h,E,f,_,O,v,x,$,N,A,q,F,B,u,b,g,y,w,s;(function(c){var H=typeof rt=="object"?rt:typeof self=="object"?self:typeof this=="object"?this:{};c(o(H,o(t.exports)));function o(d,p){return d!==H&&(typeof Object.create=="function"?Object.defineProperty(d,"__esModule",{value:!0}):d.__esModule=!0),function(D,m){return d[D]=p?p(D,m):m}}})(function(c){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,d){o.__proto__=d}||function(o,d){for(var p in d)d.hasOwnProperty(p)&&(o[p]=d[p])};e=function(o,d){H(o,d);function p(){this.constructor=o}o.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)},r=Object.assign||function(o){for(var d,p=1,D=arguments.length;p<D;p++){d=arguments[p];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(o[m]=d[m])}return o},i=function(o,d){var p={};for(var D in o)Object.prototype.hasOwnProperty.call(o,D)&&d.indexOf(D)<0&&(p[D]=o[D]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,D=Object.getOwnPropertySymbols(o);m<D.length;m++)d.indexOf(D[m])<0&&Object.prototype.propertyIsEnumerable.call(o,D[m])&&(p[D[m]]=o[D[m]]);return p},n=function(o,d,p,D){var m=arguments.length,l=m<3?d:D===null?D=Object.getOwnPropertyDescriptor(d,p):D,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(o,d,p,D);else for(var R=o.length-1;R>=0;R--)(T=o[R])&&(l=(m<3?T(l):m>3?T(d,p,l):T(d,p))||l);return m>3&&l&&Object.defineProperty(d,p,l),l},h=function(o,d){return function(p,D){d(p,D,o)}},E=function(o,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,d)},f=function(o,d,p,D){function m(l){return l instanceof p?l:new p(function(T){T(l)})}return new(p||(p=Promise))(function(l,T){function R(M){try{I(D.next(M))}catch(K){T(K)}}function z(M){try{I(D.throw(M))}catch(K){T(K)}}function I(M){M.done?l(M.value):m(M.value).then(R,z)}I((D=D.apply(o,d||[])).next())})},_=function(o,d){var p={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},D,m,l,T;return T={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function R(I){return function(M){return z([I,M])}}function z(I){if(D)throw new TypeError("Generator is already executing.");for(;p;)try{if(D=1,m&&(l=I[0]&2?m.return:I[0]?m.throw||((l=m.return)&&l.call(m),0):m.next)&&!(l=l.call(m,I[1])).done)return l;switch(m=0,l&&(I=[I[0]&2,l.value]),I[0]){case 0:case 1:l=I;break;case 4:return p.label++,{value:I[1],done:!1};case 5:p.label++,m=I[1],I=[0];continue;case 7:I=p.ops.pop(),p.trys.pop();continue;default:if(l=p.trys,!(l=l.length>0&&l[l.length-1])&&(I[0]===6||I[0]===2)){p=0;continue}if(I[0]===3&&(!l||I[1]>l[0]&&I[1]<l[3])){p.label=I[1];break}if(I[0]===6&&p.label<l[1]){p.label=l[1],l=I;break}if(l&&p.label<l[2]){p.label=l[2],p.ops.push(I);break}l[2]&&p.ops.pop(),p.trys.pop();continue}I=d.call(o,p)}catch(M){I=[6,M],m=0}finally{D=l=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}},s=function(o,d,p,D){D===void 0&&(D=p),o[D]=d[p]},O=function(o,d){for(var p in o)p!=="default"&&!d.hasOwnProperty(p)&&(d[p]=o[p])},v=function(o){var d=typeof Symbol=="function"&&Symbol.iterator,p=d&&o[d],D=0;if(p)return p.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&D>=o.length&&(o=void 0),{value:o&&o[D++],done:!o}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(o,d){var p=typeof Symbol=="function"&&o[Symbol.iterator];if(!p)return o;var D=p.call(o),m,l=[],T;try{for(;(d===void 0||d-- >0)&&!(m=D.next()).done;)l.push(m.value)}catch(R){T={error:R}}finally{try{m&&!m.done&&(p=D.return)&&p.call(D)}finally{if(T)throw T.error}}return l},$=function(){for(var o=[],d=0;d<arguments.length;d++)o=o.concat(x(arguments[d]));return o},N=function(){for(var o=0,d=0,p=arguments.length;d<p;d++)o+=arguments[d].length;for(var D=Array(o),m=0,d=0;d<p;d++)for(var l=arguments[d],T=0,R=l.length;T<R;T++,m++)D[m]=l[T];return D},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},q=function(o,d,p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D=p.apply(o,d||[]),m,l=[];return m={},T("next"),T("throw"),T("return"),m[Symbol.asyncIterator]=function(){return this},m;function T(G){D[G]&&(m[G]=function(V){return new Promise(function(Z,W){l.push([G,V,Z,W])>1||R(G,V)})})}function R(G,V){try{z(D[G](V))}catch(Z){K(l[0][3],Z)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(I,M):K(l[0][2],G)}function I(G){R("next",G)}function M(G){R("throw",G)}function K(G,V){G(V),l.shift(),l.length&&R(l[0][0],l[0][1])}},F=function(o){var d,p;return d={},D("next"),D("throw",function(m){throw m}),D("return"),d[Symbol.iterator]=function(){return this},d;function D(m,l){d[m]=o[m]?function(T){return(p=!p)?{value:A(o[m](T)),done:m==="return"}:l?l(T):T}:l}},B=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=o[Symbol.asyncIterator],p;return d?d.call(o):(o=typeof v=="function"?v(o):o[Symbol.iterator](),p={},D("next"),D("throw"),D("return"),p[Symbol.asyncIterator]=function(){return this},p);function D(l){p[l]=o[l]&&function(T){return new Promise(function(R,z){T=o[l](T),m(R,z,T.done,T.value)})}}function m(l,T,R,z){Promise.resolve(z).then(function(I){l({value:I,done:R})},T)}},u=function(o,d){return Object.defineProperty?Object.defineProperty(o,"raw",{value:d}):o.raw=d,o},b=function(o){if(o&&o.__esModule)return o;var d={};if(o!=null)for(var p in o)Object.hasOwnProperty.call(o,p)&&(d[p]=o[p]);return d.default=o,d},g=function(o){return o&&o.__esModule?o:{default:o}},y=function(o,d){if(!d.has(o))throw new TypeError("attempted to get private field on non-instance");return d.get(o)},w=function(o,d,p){if(!d.has(o))throw new TypeError("attempted to set private field on non-instance");return d.set(o,p),p},c("__extends",e),c("__assign",r),c("__rest",i),c("__decorate",n),c("__param",h),c("__metadata",E),c("__awaiter",f),c("__generator",_),c("__exportStar",O),c("__createBinding",s),c("__values",v),c("__read",x),c("__spread",$),c("__spreadArrays",N),c("__await",A),c("__asyncGenerator",q),c("__asyncDelegator",F),c("__asyncValues",B),c("__makeTemplateObject",u),c("__importStar",b),c("__importDefault",g),c("__classPrivateFieldGet",y),c("__classPrivateFieldSet",w)})})(cc);var vr={};Object.defineProperty(vr,"__esModule",{value:!0});function uc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}vr.safeJsonParse=uc;function hc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}vr.safeJsonStringify=hc;var qr={},hi={get exports(){return qr},set exports(t){qr=t}},Cn;function fc(){return Cn||(Cn=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof rt<"u"&&rt.localStorage?hi.exports=rt.localStorage:typeof window<"u"&&window.localStorage?hi.exports=window.localStorage:hi.exports=new e}()),qr}var fi={},or={},Un;function lc(){if(Un)return or;Un=1,Object.defineProperty(or,"__esModule",{value:!0}),or.IKeyValueStorage=void 0;class t{}return or.IKeyValueStorage=t,or}var cr={},Rn;function dc(){if(Rn)return cr;Rn=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.parseEntry=void 0;const t=vr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return cr.parseEntry=e,cr}var Fn;function gc(){return Fn||(Fn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=zr;e.__exportStar(lc(),t),e.__exportStar(dc(),t)}(fi)),fi}Object.defineProperty(Zr,"__esModule",{value:!0});Zr.KeyValueStorage=void 0;const Qt=zr,jn=vr,pc=Qt.__importDefault(fc()),yc=gc();class Zs{constructor(){this.localStorage=pc.default}getKeys(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(yc.parseEntry)})}getItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return jn.safeJsonParse(r)})}setItem(e,r){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,jn.safeJsonStringify(r))})}removeItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Zr.KeyValueStorage=Zs;var _c=Zr.default=Zs,Dr={},er={},bc={get exports(){return er},set exports(t){er=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,h,E,f,_,O,v,x,$,N,A,q,F,B,u,b,g,y,w,s;(function(c){var H=typeof rt=="object"?rt:typeof self=="object"?self:typeof this=="object"?this:{};c(o(H,o(t.exports)));function o(d,p){return d!==H&&(typeof Object.create=="function"?Object.defineProperty(d,"__esModule",{value:!0}):d.__esModule=!0),function(D,m){return d[D]=p?p(D,m):m}}})(function(c){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,d){o.__proto__=d}||function(o,d){for(var p in d)d.hasOwnProperty(p)&&(o[p]=d[p])};e=function(o,d){H(o,d);function p(){this.constructor=o}o.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)},r=Object.assign||function(o){for(var d,p=1,D=arguments.length;p<D;p++){d=arguments[p];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(o[m]=d[m])}return o},i=function(o,d){var p={};for(var D in o)Object.prototype.hasOwnProperty.call(o,D)&&d.indexOf(D)<0&&(p[D]=o[D]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,D=Object.getOwnPropertySymbols(o);m<D.length;m++)d.indexOf(D[m])<0&&Object.prototype.propertyIsEnumerable.call(o,D[m])&&(p[D[m]]=o[D[m]]);return p},n=function(o,d,p,D){var m=arguments.length,l=m<3?d:D===null?D=Object.getOwnPropertyDescriptor(d,p):D,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(o,d,p,D);else for(var R=o.length-1;R>=0;R--)(T=o[R])&&(l=(m<3?T(l):m>3?T(d,p,l):T(d,p))||l);return m>3&&l&&Object.defineProperty(d,p,l),l},h=function(o,d){return function(p,D){d(p,D,o)}},E=function(o,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,d)},f=function(o,d,p,D){function m(l){return l instanceof p?l:new p(function(T){T(l)})}return new(p||(p=Promise))(function(l,T){function R(M){try{I(D.next(M))}catch(K){T(K)}}function z(M){try{I(D.throw(M))}catch(K){T(K)}}function I(M){M.done?l(M.value):m(M.value).then(R,z)}I((D=D.apply(o,d||[])).next())})},_=function(o,d){var p={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},D,m,l,T;return T={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function R(I){return function(M){return z([I,M])}}function z(I){if(D)throw new TypeError("Generator is already executing.");for(;p;)try{if(D=1,m&&(l=I[0]&2?m.return:I[0]?m.throw||((l=m.return)&&l.call(m),0):m.next)&&!(l=l.call(m,I[1])).done)return l;switch(m=0,l&&(I=[I[0]&2,l.value]),I[0]){case 0:case 1:l=I;break;case 4:return p.label++,{value:I[1],done:!1};case 5:p.label++,m=I[1],I=[0];continue;case 7:I=p.ops.pop(),p.trys.pop();continue;default:if(l=p.trys,!(l=l.length>0&&l[l.length-1])&&(I[0]===6||I[0]===2)){p=0;continue}if(I[0]===3&&(!l||I[1]>l[0]&&I[1]<l[3])){p.label=I[1];break}if(I[0]===6&&p.label<l[1]){p.label=l[1],l=I;break}if(l&&p.label<l[2]){p.label=l[2],p.ops.push(I);break}l[2]&&p.ops.pop(),p.trys.pop();continue}I=d.call(o,p)}catch(M){I=[6,M],m=0}finally{D=l=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}},s=function(o,d,p,D){D===void 0&&(D=p),o[D]=d[p]},O=function(o,d){for(var p in o)p!=="default"&&!d.hasOwnProperty(p)&&(d[p]=o[p])},v=function(o){var d=typeof Symbol=="function"&&Symbol.iterator,p=d&&o[d],D=0;if(p)return p.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&D>=o.length&&(o=void 0),{value:o&&o[D++],done:!o}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(o,d){var p=typeof Symbol=="function"&&o[Symbol.iterator];if(!p)return o;var D=p.call(o),m,l=[],T;try{for(;(d===void 0||d-- >0)&&!(m=D.next()).done;)l.push(m.value)}catch(R){T={error:R}}finally{try{m&&!m.done&&(p=D.return)&&p.call(D)}finally{if(T)throw T.error}}return l},$=function(){for(var o=[],d=0;d<arguments.length;d++)o=o.concat(x(arguments[d]));return o},N=function(){for(var o=0,d=0,p=arguments.length;d<p;d++)o+=arguments[d].length;for(var D=Array(o),m=0,d=0;d<p;d++)for(var l=arguments[d],T=0,R=l.length;T<R;T++,m++)D[m]=l[T];return D},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},q=function(o,d,p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D=p.apply(o,d||[]),m,l=[];return m={},T("next"),T("throw"),T("return"),m[Symbol.asyncIterator]=function(){return this},m;function T(G){D[G]&&(m[G]=function(V){return new Promise(function(Z,W){l.push([G,V,Z,W])>1||R(G,V)})})}function R(G,V){try{z(D[G](V))}catch(Z){K(l[0][3],Z)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(I,M):K(l[0][2],G)}function I(G){R("next",G)}function M(G){R("throw",G)}function K(G,V){G(V),l.shift(),l.length&&R(l[0][0],l[0][1])}},F=function(o){var d,p;return d={},D("next"),D("throw",function(m){throw m}),D("return"),d[Symbol.iterator]=function(){return this},d;function D(m,l){d[m]=o[m]?function(T){return(p=!p)?{value:A(o[m](T)),done:m==="return"}:l?l(T):T}:l}},B=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=o[Symbol.asyncIterator],p;return d?d.call(o):(o=typeof v=="function"?v(o):o[Symbol.iterator](),p={},D("next"),D("throw"),D("return"),p[Symbol.asyncIterator]=function(){return this},p);function D(l){p[l]=o[l]&&function(T){return new Promise(function(R,z){T=o[l](T),m(R,z,T.done,T.value)})}}function m(l,T,R,z){Promise.resolve(z).then(function(I){l({value:I,done:R})},T)}},u=function(o,d){return Object.defineProperty?Object.defineProperty(o,"raw",{value:d}):o.raw=d,o},b=function(o){if(o&&o.__esModule)return o;var d={};if(o!=null)for(var p in o)Object.hasOwnProperty.call(o,p)&&(d[p]=o[p]);return d.default=o,d},g=function(o){return o&&o.__esModule?o:{default:o}},y=function(o,d){if(!d.has(o))throw new TypeError("attempted to get private field on non-instance");return d.get(o)},w=function(o,d,p){if(!d.has(o))throw new TypeError("attempted to set private field on non-instance");return d.set(o,p),p},c("__extends",e),c("__assign",r),c("__rest",i),c("__decorate",n),c("__param",h),c("__metadata",E),c("__awaiter",f),c("__generator",_),c("__exportStar",O),c("__createBinding",s),c("__values",v),c("__read",x),c("__spread",$),c("__spreadArrays",N),c("__await",A),c("__asyncGenerator",q),c("__asyncDelegator",F),c("__asyncValues",B),c("__makeTemplateObject",u),c("__importStar",b),c("__importDefault",g),c("__classPrivateFieldGet",y),c("__classPrivateFieldSet",w)})})(bc);var ur={},Q={},tr={},mc={get exports(){return tr},set exports(t){tr=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,h,E,f,_,O,v,x,$,N,A,q,F,B,u,b,g,y,w,s;(function(c){var H=typeof rt=="object"?rt:typeof self=="object"?self:typeof this=="object"?this:{};c(o(H,o(t.exports)));function o(d,p){return d!==H&&(typeof Object.create=="function"?Object.defineProperty(d,"__esModule",{value:!0}):d.__esModule=!0),function(D,m){return d[D]=p?p(D,m):m}}})(function(c){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,d){o.__proto__=d}||function(o,d){for(var p in d)d.hasOwnProperty(p)&&(o[p]=d[p])};e=function(o,d){H(o,d);function p(){this.constructor=o}o.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)},r=Object.assign||function(o){for(var d,p=1,D=arguments.length;p<D;p++){d=arguments[p];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(o[m]=d[m])}return o},i=function(o,d){var p={};for(var D in o)Object.prototype.hasOwnProperty.call(o,D)&&d.indexOf(D)<0&&(p[D]=o[D]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,D=Object.getOwnPropertySymbols(o);m<D.length;m++)d.indexOf(D[m])<0&&Object.prototype.propertyIsEnumerable.call(o,D[m])&&(p[D[m]]=o[D[m]]);return p},n=function(o,d,p,D){var m=arguments.length,l=m<3?d:D===null?D=Object.getOwnPropertyDescriptor(d,p):D,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(o,d,p,D);else for(var R=o.length-1;R>=0;R--)(T=o[R])&&(l=(m<3?T(l):m>3?T(d,p,l):T(d,p))||l);return m>3&&l&&Object.defineProperty(d,p,l),l},h=function(o,d){return function(p,D){d(p,D,o)}},E=function(o,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,d)},f=function(o,d,p,D){function m(l){return l instanceof p?l:new p(function(T){T(l)})}return new(p||(p=Promise))(function(l,T){function R(M){try{I(D.next(M))}catch(K){T(K)}}function z(M){try{I(D.throw(M))}catch(K){T(K)}}function I(M){M.done?l(M.value):m(M.value).then(R,z)}I((D=D.apply(o,d||[])).next())})},_=function(o,d){var p={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},D,m,l,T;return T={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function R(I){return function(M){return z([I,M])}}function z(I){if(D)throw new TypeError("Generator is already executing.");for(;p;)try{if(D=1,m&&(l=I[0]&2?m.return:I[0]?m.throw||((l=m.return)&&l.call(m),0):m.next)&&!(l=l.call(m,I[1])).done)return l;switch(m=0,l&&(I=[I[0]&2,l.value]),I[0]){case 0:case 1:l=I;break;case 4:return p.label++,{value:I[1],done:!1};case 5:p.label++,m=I[1],I=[0];continue;case 7:I=p.ops.pop(),p.trys.pop();continue;default:if(l=p.trys,!(l=l.length>0&&l[l.length-1])&&(I[0]===6||I[0]===2)){p=0;continue}if(I[0]===3&&(!l||I[1]>l[0]&&I[1]<l[3])){p.label=I[1];break}if(I[0]===6&&p.label<l[1]){p.label=l[1],l=I;break}if(l&&p.label<l[2]){p.label=l[2],p.ops.push(I);break}l[2]&&p.ops.pop(),p.trys.pop();continue}I=d.call(o,p)}catch(M){I=[6,M],m=0}finally{D=l=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}},s=function(o,d,p,D){D===void 0&&(D=p),o[D]=d[p]},O=function(o,d){for(var p in o)p!=="default"&&!d.hasOwnProperty(p)&&(d[p]=o[p])},v=function(o){var d=typeof Symbol=="function"&&Symbol.iterator,p=d&&o[d],D=0;if(p)return p.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&D>=o.length&&(o=void 0),{value:o&&o[D++],done:!o}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(o,d){var p=typeof Symbol=="function"&&o[Symbol.iterator];if(!p)return o;var D=p.call(o),m,l=[],T;try{for(;(d===void 0||d-- >0)&&!(m=D.next()).done;)l.push(m.value)}catch(R){T={error:R}}finally{try{m&&!m.done&&(p=D.return)&&p.call(D)}finally{if(T)throw T.error}}return l},$=function(){for(var o=[],d=0;d<arguments.length;d++)o=o.concat(x(arguments[d]));return o},N=function(){for(var o=0,d=0,p=arguments.length;d<p;d++)o+=arguments[d].length;for(var D=Array(o),m=0,d=0;d<p;d++)for(var l=arguments[d],T=0,R=l.length;T<R;T++,m++)D[m]=l[T];return D},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},q=function(o,d,p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D=p.apply(o,d||[]),m,l=[];return m={},T("next"),T("throw"),T("return"),m[Symbol.asyncIterator]=function(){return this},m;function T(G){D[G]&&(m[G]=function(V){return new Promise(function(Z,W){l.push([G,V,Z,W])>1||R(G,V)})})}function R(G,V){try{z(D[G](V))}catch(Z){K(l[0][3],Z)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(I,M):K(l[0][2],G)}function I(G){R("next",G)}function M(G){R("throw",G)}function K(G,V){G(V),l.shift(),l.length&&R(l[0][0],l[0][1])}},F=function(o){var d,p;return d={},D("next"),D("throw",function(m){throw m}),D("return"),d[Symbol.iterator]=function(){return this},d;function D(m,l){d[m]=o[m]?function(T){return(p=!p)?{value:A(o[m](T)),done:m==="return"}:l?l(T):T}:l}},B=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=o[Symbol.asyncIterator],p;return d?d.call(o):(o=typeof v=="function"?v(o):o[Symbol.iterator](),p={},D("next"),D("throw"),D("return"),p[Symbol.asyncIterator]=function(){return this},p);function D(l){p[l]=o[l]&&function(T){return new Promise(function(R,z){T=o[l](T),m(R,z,T.done,T.value)})}}function m(l,T,R,z){Promise.resolve(z).then(function(I){l({value:I,done:R})},T)}},u=function(o,d){return Object.defineProperty?Object.defineProperty(o,"raw",{value:d}):o.raw=d,o},b=function(o){if(o&&o.__esModule)return o;var d={};if(o!=null)for(var p in o)Object.hasOwnProperty.call(o,p)&&(d[p]=o[p]);return d.default=o,d},g=function(o){return o&&o.__esModule?o:{default:o}},y=function(o,d){if(!d.has(o))throw new TypeError("attempted to get private field on non-instance");return d.get(o)},w=function(o,d,p){if(!d.has(o))throw new TypeError("attempted to set private field on non-instance");return d.set(o,p),p},c("__extends",e),c("__assign",r),c("__rest",i),c("__decorate",n),c("__param",h),c("__metadata",E),c("__awaiter",f),c("__generator",_),c("__exportStar",O),c("__createBinding",s),c("__values",v),c("__read",x),c("__spread",$),c("__spreadArrays",N),c("__await",A),c("__asyncGenerator",q),c("__asyncDelegator",F),c("__asyncValues",B),c("__makeTemplateObject",u),c("__importStar",b),c("__importDefault",g),c("__classPrivateFieldGet",y),c("__classPrivateFieldSet",w)})})(mc);var li={},hr={},Ln;function wc(){if(Ln)return hr;Ln=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return hr.delay=t,hr}var zt={},di={},qt={},$n;function Ec(){return $n||($n=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.ONE_THOUSAND=qt.ONE_HUNDRED=void 0,qt.ONE_HUNDRED=100,qt.ONE_THOUSAND=1e3),qt}var gi={},Mn;function vc(){return Mn||(Mn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(gi)),gi}var Hn;function Qs(){return Hn||(Hn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=tr;e.__exportStar(Ec(),t),e.__exportStar(vc(),t)}(di)),di}var zn;function Dc(){if(zn)return zt;zn=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.fromMiliseconds=zt.toMiliseconds=void 0;const t=Qs();function e(i){return i*t.ONE_THOUSAND}zt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return zt.fromMiliseconds=r,zt}var qn;function Sc(){return qn||(qn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=tr;e.__exportStar(wc(),t),e.__exportStar(Dc(),t)}(li)),li}var Jt={},Bn;function Oc(){if(Bn)return Jt;Bn=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Jt.Watch=t,Jt.default=t,Jt}var pi={},fr={},Kn;function Ic(){if(Kn)return fr;Kn=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.IWatch=void 0;class t{}return fr.IWatch=t,fr}var Vn;function xc(){return Vn||(Vn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),tr.__exportStar(Ic(),t)}(pi)),pi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=tr;e.__exportStar(Sc(),t),e.__exportStar(Oc(),t),e.__exportStar(xc(),t),e.__exportStar(Qs(),t)})(Q);var yi={},lr={};class Gt{}const Pc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gt},Symbol.toStringTag,{value:"Module"})),Tc=zo(Pc);var Gn;function Ac(){if(Gn)return lr;Gn=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.IHeartBeat=void 0;const t=Tc;class e extends t.IEvents{constructor(i){super()}}return lr.IHeartBeat=e,lr}var kn;function ea(){return kn||(kn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),er.__exportStar(Ac(),t)}(yi)),yi}var _i={},Bt={},Yn;function Nc(){if(Yn)return Bt;Yn=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.HEARTBEAT_EVENTS=Bt.HEARTBEAT_INTERVAL=void 0;const t=Q;return Bt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Bt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Bt}var Wn;function ta(){return Wn||(Wn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),er.__exportStar(Nc(),t)}(_i)),_i}var Jn;function Cc(){if(Jn)return ur;Jn=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.HeartBeat=void 0;const t=er,e=lt,r=Q,i=ea(),n=ta();class h extends i.IHeartBeat{constructor(f){super(f),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=(f==null?void 0:f.interval)||n.HEARTBEAT_INTERVAL}static init(f){return t.__awaiter(this,void 0,void 0,function*(){const _=new h(f);return yield _.init(),_})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(f,_){this.events.on(f,_)}once(f,_){this.events.once(f,_)}off(f,_){this.events.off(f,_)}removeListener(f,_){this.events.removeListener(f,_)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return ur.HeartBeat=h,ur}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=er;e.__exportStar(Cc(),t),e.__exportStar(ea(),t),e.__exportStar(ta(),t)})(Dr);var Se={},Ti={},Uc={get exports(){return Ti},set exports(t){Ti=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,h,E,f,_,O,v,x,$,N,A,q,F,B,u,b,g,y,w,s;(function(c){var H=typeof rt=="object"?rt:typeof self=="object"?self:typeof this=="object"?this:{};c(o(H,o(t.exports)));function o(d,p){return d!==H&&(typeof Object.create=="function"?Object.defineProperty(d,"__esModule",{value:!0}):d.__esModule=!0),function(D,m){return d[D]=p?p(D,m):m}}})(function(c){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,d){o.__proto__=d}||function(o,d){for(var p in d)d.hasOwnProperty(p)&&(o[p]=d[p])};e=function(o,d){H(o,d);function p(){this.constructor=o}o.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)},r=Object.assign||function(o){for(var d,p=1,D=arguments.length;p<D;p++){d=arguments[p];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(o[m]=d[m])}return o},i=function(o,d){var p={};for(var D in o)Object.prototype.hasOwnProperty.call(o,D)&&d.indexOf(D)<0&&(p[D]=o[D]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,D=Object.getOwnPropertySymbols(o);m<D.length;m++)d.indexOf(D[m])<0&&Object.prototype.propertyIsEnumerable.call(o,D[m])&&(p[D[m]]=o[D[m]]);return p},n=function(o,d,p,D){var m=arguments.length,l=m<3?d:D===null?D=Object.getOwnPropertyDescriptor(d,p):D,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(o,d,p,D);else for(var R=o.length-1;R>=0;R--)(T=o[R])&&(l=(m<3?T(l):m>3?T(d,p,l):T(d,p))||l);return m>3&&l&&Object.defineProperty(d,p,l),l},h=function(o,d){return function(p,D){d(p,D,o)}},E=function(o,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,d)},f=function(o,d,p,D){function m(l){return l instanceof p?l:new p(function(T){T(l)})}return new(p||(p=Promise))(function(l,T){function R(M){try{I(D.next(M))}catch(K){T(K)}}function z(M){try{I(D.throw(M))}catch(K){T(K)}}function I(M){M.done?l(M.value):m(M.value).then(R,z)}I((D=D.apply(o,d||[])).next())})},_=function(o,d){var p={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},D,m,l,T;return T={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function R(I){return function(M){return z([I,M])}}function z(I){if(D)throw new TypeError("Generator is already executing.");for(;p;)try{if(D=1,m&&(l=I[0]&2?m.return:I[0]?m.throw||((l=m.return)&&l.call(m),0):m.next)&&!(l=l.call(m,I[1])).done)return l;switch(m=0,l&&(I=[I[0]&2,l.value]),I[0]){case 0:case 1:l=I;break;case 4:return p.label++,{value:I[1],done:!1};case 5:p.label++,m=I[1],I=[0];continue;case 7:I=p.ops.pop(),p.trys.pop();continue;default:if(l=p.trys,!(l=l.length>0&&l[l.length-1])&&(I[0]===6||I[0]===2)){p=0;continue}if(I[0]===3&&(!l||I[1]>l[0]&&I[1]<l[3])){p.label=I[1];break}if(I[0]===6&&p.label<l[1]){p.label=l[1],l=I;break}if(l&&p.label<l[2]){p.label=l[2],p.ops.push(I);break}l[2]&&p.ops.pop(),p.trys.pop();continue}I=d.call(o,p)}catch(M){I=[6,M],m=0}finally{D=l=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}},s=function(o,d,p,D){D===void 0&&(D=p),o[D]=d[p]},O=function(o,d){for(var p in o)p!=="default"&&!d.hasOwnProperty(p)&&(d[p]=o[p])},v=function(o){var d=typeof Symbol=="function"&&Symbol.iterator,p=d&&o[d],D=0;if(p)return p.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&D>=o.length&&(o=void 0),{value:o&&o[D++],done:!o}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(o,d){var p=typeof Symbol=="function"&&o[Symbol.iterator];if(!p)return o;var D=p.call(o),m,l=[],T;try{for(;(d===void 0||d-- >0)&&!(m=D.next()).done;)l.push(m.value)}catch(R){T={error:R}}finally{try{m&&!m.done&&(p=D.return)&&p.call(D)}finally{if(T)throw T.error}}return l},$=function(){for(var o=[],d=0;d<arguments.length;d++)o=o.concat(x(arguments[d]));return o},N=function(){for(var o=0,d=0,p=arguments.length;d<p;d++)o+=arguments[d].length;for(var D=Array(o),m=0,d=0;d<p;d++)for(var l=arguments[d],T=0,R=l.length;T<R;T++,m++)D[m]=l[T];return D},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},q=function(o,d,p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D=p.apply(o,d||[]),m,l=[];return m={},T("next"),T("throw"),T("return"),m[Symbol.asyncIterator]=function(){return this},m;function T(G){D[G]&&(m[G]=function(V){return new Promise(function(Z,W){l.push([G,V,Z,W])>1||R(G,V)})})}function R(G,V){try{z(D[G](V))}catch(Z){K(l[0][3],Z)}}function z(G){G.value instanceof A?Promise.resolve(G.value.v).then(I,M):K(l[0][2],G)}function I(G){R("next",G)}function M(G){R("throw",G)}function K(G,V){G(V),l.shift(),l.length&&R(l[0][0],l[0][1])}},F=function(o){var d,p;return d={},D("next"),D("throw",function(m){throw m}),D("return"),d[Symbol.iterator]=function(){return this},d;function D(m,l){d[m]=o[m]?function(T){return(p=!p)?{value:A(o[m](T)),done:m==="return"}:l?l(T):T}:l}},B=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=o[Symbol.asyncIterator],p;return d?d.call(o):(o=typeof v=="function"?v(o):o[Symbol.iterator](),p={},D("next"),D("throw"),D("return"),p[Symbol.asyncIterator]=function(){return this},p);function D(l){p[l]=o[l]&&function(T){return new Promise(function(R,z){T=o[l](T),m(R,z,T.done,T.value)})}}function m(l,T,R,z){Promise.resolve(z).then(function(I){l({value:I,done:R})},T)}},u=function(o,d){return Object.defineProperty?Object.defineProperty(o,"raw",{value:d}):o.raw=d,o},b=function(o){if(o&&o.__esModule)return o;var d={};if(o!=null)for(var p in o)Object.hasOwnProperty.call(o,p)&&(d[p]=o[p]);return d.default=o,d},g=function(o){return o&&o.__esModule?o:{default:o}},y=function(o,d){if(!d.has(o))throw new TypeError("attempted to get private field on non-instance");return d.get(o)},w=function(o,d,p){if(!d.has(o))throw new TypeError("attempted to set private field on non-instance");return d.set(o,p),p},c("__extends",e),c("__assign",r),c("__rest",i),c("__decorate",n),c("__param",h),c("__metadata",E),c("__awaiter",f),c("__generator",_),c("__exportStar",O),c("__createBinding",s),c("__values",v),c("__read",x),c("__spread",$),c("__spreadArrays",N),c("__await",A),c("__asyncGenerator",q),c("__asyncDelegator",F),c("__asyncValues",B),c("__makeTemplateObject",u),c("__importStar",b),c("__importDefault",g),c("__classPrivateFieldGet",y),c("__classPrivateFieldSet",w)})})(Uc);var Kt={},Xn;function ra(){return Xn||(Xn=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PINO_CUSTOM_CONTEXT_KEY=Kt.PINO_LOGGER_DEFAULTS=void 0,Kt.PINO_LOGGER_DEFAULTS={level:"info"},Kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Kt}var tt={},Zn;function Rc(){if(Zn)return tt;Zn=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.generateChildLogger=tt.formatChildLoggerContext=tt.getLoggerContext=tt.setBrowserLoggerContext=tt.getBrowserLoggerContext=tt.getDefaultLoggerOptions=void 0;const t=ra();function e(f){return Object.assign(Object.assign({},f),{level:(f==null?void 0:f.level)||t.PINO_LOGGER_DEFAULTS.level})}tt.getDefaultLoggerOptions=e;function r(f,_=t.PINO_CUSTOM_CONTEXT_KEY){return f[_]||""}tt.getBrowserLoggerContext=r;function i(f,_,O=t.PINO_CUSTOM_CONTEXT_KEY){return f[O]=_,f}tt.setBrowserLoggerContext=i;function n(f,_=t.PINO_CUSTOM_CONTEXT_KEY){let O="";return typeof f.bindings>"u"?O=r(f,_):O=f.bindings().context||"",O}tt.getLoggerContext=n;function h(f,_,O=t.PINO_CUSTOM_CONTEXT_KEY){const v=n(f,O);return v.trim()?`${v}/${_}`:_}tt.formatChildLoggerContext=h;function E(f,_,O=t.PINO_CUSTOM_CONTEXT_KEY){const v=h(f,_,O),x=f.child({context:v});return i(x,v,O)}return tt.generateChildLogger=E,tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Ti,r=e.__importDefault(Er);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(ra(),t),e.__exportStar(Rc(),t)})(Se);class Fc extends Gt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let jc=class extends Gt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},Lc=class{constructor(e,r){this.logger=e,this.core=r}},$c=class extends Gt{constructor(e,r){super(),this.relayer=e,this.logger=r}};class Mc extends Gt{constructor(e){super()}}let Hc=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}};class zc extends Gt{constructor(e,r){super(),this.relayer=e,this.logger=r}}let qc=class extends Gt{constructor(e,r){super(),this.core=e,this.logger=r}};var Zi={},rr={},Qr={},ei={};Object.defineProperty(ei,"__esModule",{value:!0});ei.BrowserRandomSource=void 0;const Qn=65536;class Bc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Qn)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Qn)));return r}}ei.BrowserRandomSource=Bc;function Kc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ti={},ct={};Object.defineProperty(ct,"__esModule",{value:!0});function Vc(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ct.wipe=Vc;Object.defineProperty(ti,"__esModule",{value:!0});ti.NodeRandomSource=void 0;const Gc=ct;class kc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Kc<"u"){const e=qo;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,Gc.wipe)(r),i}}ti.NodeRandomSource=kc;Object.defineProperty(Qr,"__esModule",{value:!0});Qr.SystemRandomSource=void 0;const Yc=ei,Wc=ti;class Jc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Yc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Wc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Qr.SystemRandomSource=Jc;var ie={},ia={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(f,_){var O=f>>>16&65535,v=f&65535,x=_>>>16&65535,$=_&65535;return v*$+(O*$+v*x<<16>>>0)|0}t.mul=Math.imul||e;function r(f,_){return f+_|0}t.add=r;function i(f,_){return f-_|0}t.sub=i;function n(f,_){return f<<_|f>>>32-_}t.rotl=n;function h(f,_){return f<<32-_|f>>>_}t.rotr=h;function E(f){return typeof f=="number"&&isFinite(f)&&Math.floor(f)===f}t.isInteger=Number.isInteger||E,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(f){return t.isInteger(f)&&f>=-t.MAX_SAFE_INTEGER&&f<=t.MAX_SAFE_INTEGER}})(ia);Object.defineProperty(ie,"__esModule",{value:!0});var na=ia;function Xc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ie.readInt16BE=Xc;function Zc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ie.readUint16BE=Zc;function Qc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ie.readInt16LE=Qc;function eu(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ie.readUint16LE=eu;function sa(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ie.writeUint16BE=sa;ie.writeInt16BE=sa;function aa(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ie.writeUint16LE=aa;ie.writeInt16LE=aa;function Ai(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ie.readInt32BE=Ai;function Ni(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ie.readUint32BE=Ni;function Ci(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ie.readInt32LE=Ci;function Ui(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ie.readUint32LE=Ui;function Br(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ie.writeUint32BE=Br;ie.writeInt32BE=Br;function Kr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ie.writeUint32LE=Kr;ie.writeInt32LE=Kr;function tu(t,e){e===void 0&&(e=0);var r=Ai(t,e),i=Ai(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=tu;function ru(t,e){e===void 0&&(e=0);var r=Ni(t,e),i=Ni(t,e+4);return r*4294967296+i}ie.readUint64BE=ru;function iu(t,e){e===void 0&&(e=0);var r=Ci(t,e),i=Ci(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ie.readInt64LE=iu;function nu(t,e){e===void 0&&(e=0);var r=Ui(t,e),i=Ui(t,e+4);return i*4294967296+r}ie.readUint64LE=nu;function oa(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Br(t/4294967296>>>0,e,r),Br(t>>>0,e,r+4),e}ie.writeUint64BE=oa;ie.writeInt64BE=oa;function ca(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Kr(t>>>0,e,r),Kr(t/4294967296>>>0,e,r+4),e}ie.writeUint64LE=ca;ie.writeInt64LE=ca;function su(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,h=t/8+r-1;h>=r;h--)i+=e[h]*n,n*=256;return i}ie.readUintBE=su;function au(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,h=r;h<r+t/8;h++)i+=e[h]*n,n*=256;return i}ie.readUintLE=au;function ou(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!na.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,h=t/8+i-1;h>=i;h--)r[h]=e/n&255,n*=256;return r}ie.writeUintBE=ou;function cu(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!na.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,h=i;h<i+t/8;h++)r[h]=e/n&255,n*=256;return r}ie.writeUintLE=cu;function uu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ie.readFloat32BE=uu;function hu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ie.readFloat32LE=hu;function fu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ie.readFloat64BE=fu;function lu(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ie.readFloat64LE=lu;function du(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ie.writeFloat32BE=du;function gu(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ie.writeFloat32LE=gu;function pu(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ie.writeFloat64BE=pu;function yu(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ie.writeFloat64LE=yu;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Qr,r=ie,i=ct;t.defaultRandomSource=new e.SystemRandomSource;function n(O,v=t.defaultRandomSource){return v.randomBytes(O)}t.randomBytes=n;function h(O=t.defaultRandomSource){const v=n(4,O),x=(0,r.readUint32LE)(v);return(0,i.wipe)(v),x}t.randomUint32=h;const E="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function f(O,v=E,x=t.defaultRandomSource){if(v.length<2)throw new Error("randomString charset is too short");if(v.length>256)throw new Error("randomString charset is too long");let $="";const N=v.length,A=256-256%N;for(;O>0;){const q=n(Math.ceil(O*256/A),x);for(let F=0;F<q.length&&O>0;F++){const B=q[F];B<A&&($+=v.charAt(B%N),O--)}(0,i.wipe)(q)}return $}t.randomString=f;function _(O,v=E,x=t.defaultRandomSource){const $=Math.ceil(O/(Math.log(v.length)/Math.LN2));return f($,v,x)}t.randomStringForEntropy=_})(rr);var ua={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=ct;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function f(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return f.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},f.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},f.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},f.prototype.update=function(_,O){if(O===void 0&&(O=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var v=0;if(this._bytesHashed+=O,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&O>0;)this._buffer[this._bufferLength++]=_[v++],O--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(O>=this.blockSize&&(v=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,v,O),O%=this.blockSize);O>0;)this._buffer[this._bufferLength++]=_[v++],O--;return this},f.prototype.finish=function(_){if(!this._finished){var O=this._bytesHashed,v=this._bufferLength,x=O/536870912|0,$=O<<3,N=O%128<112?128:256;this._buffer[v]=128;for(var A=v+1;A<N-8;A++)this._buffer[A]=0;e.writeUint32BE(x,this._buffer,N-8),e.writeUint32BE($,this._buffer,N-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)e.writeUint32BE(this._stateHi[A],_,A*8),e.writeUint32BE(this._stateLo[A],_,A*8+4);return this},f.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},f.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},f.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},f.prototype.cleanSavedState=function(_){r.wipe(_.stateHi),r.wipe(_.stateLo),_.buffer&&r.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},f}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(f,_,O,v,x,$,N){for(var A=O[0],q=O[1],F=O[2],B=O[3],u=O[4],b=O[5],g=O[6],y=O[7],w=v[0],s=v[1],c=v[2],H=v[3],o=v[4],d=v[5],p=v[6],D=v[7],m,l,T,R,z,I,M,K;N>=128;){for(var G=0;G<16;G++){var V=8*G+$;f[G]=e.readUint32BE(x,V),_[G]=e.readUint32BE(x,V+4)}for(var G=0;G<80;G++){var Z=A,W=q,oe=F,L=B,j=u,C=b,a=g,P=y,Y=w,J=s,fe=c,_e=H,de=o,we=d,Ue=p,Te=D;if(m=y,l=D,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=(u>>>14|o<<32-14)^(u>>>18|o<<32-18)^(o>>>41-32|u<<32-(41-32)),l=(o>>>14|u<<32-14)^(o>>>18|u<<32-18)^(u>>>41-32|o<<32-(41-32)),z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,m=u&b^~u&g,l=o&d^~o&p,z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,m=n[G*2],l=n[G*2+1],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,m=f[G%16],l=_[G%16],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,T=M&65535|K<<16,R=z&65535|I<<16,m=T,l=R,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=(A>>>28|w<<32-28)^(w>>>34-32|A<<32-(34-32))^(w>>>39-32|A<<32-(39-32)),l=(w>>>28|A<<32-28)^(A>>>34-32|w<<32-(34-32))^(A>>>39-32|w<<32-(39-32)),z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,m=A&q^A&F^q&F,l=w&s^w&c^s&c,z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,P=M&65535|K<<16,Te=z&65535|I<<16,m=L,l=_e,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=T,l=R,z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,L=M&65535|K<<16,_e=z&65535|I<<16,q=Z,F=W,B=oe,u=L,b=j,g=C,y=a,A=P,s=Y,c=J,H=fe,o=_e,d=de,p=we,D=Ue,w=Te,G%16===15)for(var V=0;V<16;V++)m=f[V],l=_[V],z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=f[(V+9)%16],l=_[(V+9)%16],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,T=f[(V+1)%16],R=_[(V+1)%16],m=(T>>>1|R<<32-1)^(T>>>8|R<<32-8)^T>>>7,l=(R>>>1|T<<32-1)^(R>>>8|T<<32-8)^(R>>>7|T<<32-7),z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,T=f[(V+14)%16],R=_[(V+14)%16],m=(T>>>19|R<<32-19)^(R>>>61-32|T<<32-(61-32))^T>>>6,l=(R>>>19|T<<32-19)^(T>>>61-32|R<<32-(61-32))^(R>>>6|T<<32-6),z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,f[V]=M&65535|K<<16,_[V]=z&65535|I<<16}m=A,l=w,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[0],l=v[0],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[0]=A=M&65535|K<<16,v[0]=w=z&65535|I<<16,m=q,l=s,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[1],l=v[1],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[1]=q=M&65535|K<<16,v[1]=s=z&65535|I<<16,m=F,l=c,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[2],l=v[2],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[2]=F=M&65535|K<<16,v[2]=c=z&65535|I<<16,m=B,l=H,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[3],l=v[3],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[3]=B=M&65535|K<<16,v[3]=H=z&65535|I<<16,m=u,l=o,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[4],l=v[4],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[4]=u=M&65535|K<<16,v[4]=o=z&65535|I<<16,m=b,l=d,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[5],l=v[5],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[5]=b=M&65535|K<<16,v[5]=d=z&65535|I<<16,m=g,l=p,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[6],l=v[6],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[6]=g=M&65535|K<<16,v[6]=p=z&65535|I<<16,m=y,l=D,z=l&65535,I=l>>>16,M=m&65535,K=m>>>16,m=O[7],l=v[7],z+=l&65535,I+=l>>>16,M+=m&65535,K+=m>>>16,I+=z>>>16,M+=I>>>16,K+=M>>>16,O[7]=y=M&65535|K<<16,v[7]=D=z&65535|I<<16,$+=128,N-=128}return $}function E(f){var _=new i;_.update(f);var O=_.digest();return _.clean(),O}t.hash=E})(ua);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=rr,r=ua,i=ct;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(L){const j=new Float64Array(16);if(L)for(let C=0;C<L.length;C++)j[C]=L[C];return j}const h=new Uint8Array(32);h[0]=9;const E=n(),f=n([1]),_=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),O=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),v=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),x=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),$=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N(L,j){for(let C=0;C<16;C++)L[C]=j[C]|0}function A(L){let j=1;for(let C=0;C<16;C++){let a=L[C]+j+65535;j=Math.floor(a/65536),L[C]=a-j*65536}L[0]+=j-1+37*(j-1)}function q(L,j,C){const a=~(C-1);for(let P=0;P<16;P++){const Y=a&(L[P]^j[P]);L[P]^=Y,j[P]^=Y}}function F(L,j){const C=n(),a=n();for(let P=0;P<16;P++)a[P]=j[P];A(a),A(a),A(a);for(let P=0;P<2;P++){C[0]=a[0]-65517;for(let J=1;J<15;J++)C[J]=a[J]-65535-(C[J-1]>>16&1),C[J-1]&=65535;C[15]=a[15]-32767-(C[14]>>16&1);const Y=C[15]>>16&1;C[14]&=65535,q(a,C,1-Y)}for(let P=0;P<16;P++)L[2*P]=a[P]&255,L[2*P+1]=a[P]>>8}function B(L,j){let C=0;for(let a=0;a<32;a++)C|=L[a]^j[a];return(1&C-1>>>8)-1}function u(L,j){const C=new Uint8Array(32),a=new Uint8Array(32);return F(C,L),F(a,j),B(C,a)}function b(L){const j=new Uint8Array(32);return F(j,L),j[0]&1}function g(L,j){for(let C=0;C<16;C++)L[C]=j[2*C]+(j[2*C+1]<<8);L[15]&=32767}function y(L,j,C){for(let a=0;a<16;a++)L[a]=j[a]+C[a]}function w(L,j,C){for(let a=0;a<16;a++)L[a]=j[a]-C[a]}function s(L,j,C){let a,P,Y=0,J=0,fe=0,_e=0,de=0,we=0,Ue=0,Te=0,ye=0,ge=0,le=0,ue=0,ce=0,ae=0,se=0,te=0,he=0,pe=0,re=0,be=0,me=0,ve=0,De=0,Ee=0,dt=0,bt=0,Pt=0,st=0,Lt=0,nr=0,Tr=0,Re=C[0],Ae=C[1],Fe=C[2],je=C[3],Le=C[4],Ne=C[5],He=C[6],ze=C[7],qe=C[8],Be=C[9],Ke=C[10],Me=C[11],$e=C[12],xe=C[13],Ve=C[14],Ge=C[15];a=j[0],Y+=a*Re,J+=a*Ae,fe+=a*Fe,_e+=a*je,de+=a*Le,we+=a*Ne,Ue+=a*He,Te+=a*ze,ye+=a*qe,ge+=a*Be,le+=a*Ke,ue+=a*Me,ce+=a*$e,ae+=a*xe,se+=a*Ve,te+=a*Ge,a=j[1],J+=a*Re,fe+=a*Ae,_e+=a*Fe,de+=a*je,we+=a*Le,Ue+=a*Ne,Te+=a*He,ye+=a*ze,ge+=a*qe,le+=a*Be,ue+=a*Ke,ce+=a*Me,ae+=a*$e,se+=a*xe,te+=a*Ve,he+=a*Ge,a=j[2],fe+=a*Re,_e+=a*Ae,de+=a*Fe,we+=a*je,Ue+=a*Le,Te+=a*Ne,ye+=a*He,ge+=a*ze,le+=a*qe,ue+=a*Be,ce+=a*Ke,ae+=a*Me,se+=a*$e,te+=a*xe,he+=a*Ve,pe+=a*Ge,a=j[3],_e+=a*Re,de+=a*Ae,we+=a*Fe,Ue+=a*je,Te+=a*Le,ye+=a*Ne,ge+=a*He,le+=a*ze,ue+=a*qe,ce+=a*Be,ae+=a*Ke,se+=a*Me,te+=a*$e,he+=a*xe,pe+=a*Ve,re+=a*Ge,a=j[4],de+=a*Re,we+=a*Ae,Ue+=a*Fe,Te+=a*je,ye+=a*Le,ge+=a*Ne,le+=a*He,ue+=a*ze,ce+=a*qe,ae+=a*Be,se+=a*Ke,te+=a*Me,he+=a*$e,pe+=a*xe,re+=a*Ve,be+=a*Ge,a=j[5],we+=a*Re,Ue+=a*Ae,Te+=a*Fe,ye+=a*je,ge+=a*Le,le+=a*Ne,ue+=a*He,ce+=a*ze,ae+=a*qe,se+=a*Be,te+=a*Ke,he+=a*Me,pe+=a*$e,re+=a*xe,be+=a*Ve,me+=a*Ge,a=j[6],Ue+=a*Re,Te+=a*Ae,ye+=a*Fe,ge+=a*je,le+=a*Le,ue+=a*Ne,ce+=a*He,ae+=a*ze,se+=a*qe,te+=a*Be,he+=a*Ke,pe+=a*Me,re+=a*$e,be+=a*xe,me+=a*Ve,ve+=a*Ge,a=j[7],Te+=a*Re,ye+=a*Ae,ge+=a*Fe,le+=a*je,ue+=a*Le,ce+=a*Ne,ae+=a*He,se+=a*ze,te+=a*qe,he+=a*Be,pe+=a*Ke,re+=a*Me,be+=a*$e,me+=a*xe,ve+=a*Ve,De+=a*Ge,a=j[8],ye+=a*Re,ge+=a*Ae,le+=a*Fe,ue+=a*je,ce+=a*Le,ae+=a*Ne,se+=a*He,te+=a*ze,he+=a*qe,pe+=a*Be,re+=a*Ke,be+=a*Me,me+=a*$e,ve+=a*xe,De+=a*Ve,Ee+=a*Ge,a=j[9],ge+=a*Re,le+=a*Ae,ue+=a*Fe,ce+=a*je,ae+=a*Le,se+=a*Ne,te+=a*He,he+=a*ze,pe+=a*qe,re+=a*Be,be+=a*Ke,me+=a*Me,ve+=a*$e,De+=a*xe,Ee+=a*Ve,dt+=a*Ge,a=j[10],le+=a*Re,ue+=a*Ae,ce+=a*Fe,ae+=a*je,se+=a*Le,te+=a*Ne,he+=a*He,pe+=a*ze,re+=a*qe,be+=a*Be,me+=a*Ke,ve+=a*Me,De+=a*$e,Ee+=a*xe,dt+=a*Ve,bt+=a*Ge,a=j[11],ue+=a*Re,ce+=a*Ae,ae+=a*Fe,se+=a*je,te+=a*Le,he+=a*Ne,pe+=a*He,re+=a*ze,be+=a*qe,me+=a*Be,ve+=a*Ke,De+=a*Me,Ee+=a*$e,dt+=a*xe,bt+=a*Ve,Pt+=a*Ge,a=j[12],ce+=a*Re,ae+=a*Ae,se+=a*Fe,te+=a*je,he+=a*Le,pe+=a*Ne,re+=a*He,be+=a*ze,me+=a*qe,ve+=a*Be,De+=a*Ke,Ee+=a*Me,dt+=a*$e,bt+=a*xe,Pt+=a*Ve,st+=a*Ge,a=j[13],ae+=a*Re,se+=a*Ae,te+=a*Fe,he+=a*je,pe+=a*Le,re+=a*Ne,be+=a*He,me+=a*ze,ve+=a*qe,De+=a*Be,Ee+=a*Ke,dt+=a*Me,bt+=a*$e,Pt+=a*xe,st+=a*Ve,Lt+=a*Ge,a=j[14],se+=a*Re,te+=a*Ae,he+=a*Fe,pe+=a*je,re+=a*Le,be+=a*Ne,me+=a*He,ve+=a*ze,De+=a*qe,Ee+=a*Be,dt+=a*Ke,bt+=a*Me,Pt+=a*$e,st+=a*xe,Lt+=a*Ve,nr+=a*Ge,a=j[15],te+=a*Re,he+=a*Ae,pe+=a*Fe,re+=a*je,be+=a*Le,me+=a*Ne,ve+=a*He,De+=a*ze,Ee+=a*qe,dt+=a*Be,bt+=a*Ke,Pt+=a*Me,st+=a*$e,Lt+=a*xe,nr+=a*Ve,Tr+=a*Ge,Y+=38*he,J+=38*pe,fe+=38*re,_e+=38*be,de+=38*me,we+=38*ve,Ue+=38*De,Te+=38*Ee,ye+=38*dt,ge+=38*bt,le+=38*Pt,ue+=38*st,ce+=38*Lt,ae+=38*nr,se+=38*Tr,P=1,a=Y+P+65535,P=Math.floor(a/65536),Y=a-P*65536,a=J+P+65535,P=Math.floor(a/65536),J=a-P*65536,a=fe+P+65535,P=Math.floor(a/65536),fe=a-P*65536,a=_e+P+65535,P=Math.floor(a/65536),_e=a-P*65536,a=de+P+65535,P=Math.floor(a/65536),de=a-P*65536,a=we+P+65535,P=Math.floor(a/65536),we=a-P*65536,a=Ue+P+65535,P=Math.floor(a/65536),Ue=a-P*65536,a=Te+P+65535,P=Math.floor(a/65536),Te=a-P*65536,a=ye+P+65535,P=Math.floor(a/65536),ye=a-P*65536,a=ge+P+65535,P=Math.floor(a/65536),ge=a-P*65536,a=le+P+65535,P=Math.floor(a/65536),le=a-P*65536,a=ue+P+65535,P=Math.floor(a/65536),ue=a-P*65536,a=ce+P+65535,P=Math.floor(a/65536),ce=a-P*65536,a=ae+P+65535,P=Math.floor(a/65536),ae=a-P*65536,a=se+P+65535,P=Math.floor(a/65536),se=a-P*65536,a=te+P+65535,P=Math.floor(a/65536),te=a-P*65536,Y+=P-1+37*(P-1),P=1,a=Y+P+65535,P=Math.floor(a/65536),Y=a-P*65536,a=J+P+65535,P=Math.floor(a/65536),J=a-P*65536,a=fe+P+65535,P=Math.floor(a/65536),fe=a-P*65536,a=_e+P+65535,P=Math.floor(a/65536),_e=a-P*65536,a=de+P+65535,P=Math.floor(a/65536),de=a-P*65536,a=we+P+65535,P=Math.floor(a/65536),we=a-P*65536,a=Ue+P+65535,P=Math.floor(a/65536),Ue=a-P*65536,a=Te+P+65535,P=Math.floor(a/65536),Te=a-P*65536,a=ye+P+65535,P=Math.floor(a/65536),ye=a-P*65536,a=ge+P+65535,P=Math.floor(a/65536),ge=a-P*65536,a=le+P+65535,P=Math.floor(a/65536),le=a-P*65536,a=ue+P+65535,P=Math.floor(a/65536),ue=a-P*65536,a=ce+P+65535,P=Math.floor(a/65536),ce=a-P*65536,a=ae+P+65535,P=Math.floor(a/65536),ae=a-P*65536,a=se+P+65535,P=Math.floor(a/65536),se=a-P*65536,a=te+P+65535,P=Math.floor(a/65536),te=a-P*65536,Y+=P-1+37*(P-1),L[0]=Y,L[1]=J,L[2]=fe,L[3]=_e,L[4]=de,L[5]=we,L[6]=Ue,L[7]=Te,L[8]=ye,L[9]=ge,L[10]=le,L[11]=ue,L[12]=ce,L[13]=ae,L[14]=se,L[15]=te}function c(L,j){s(L,j,j)}function H(L,j){const C=n();let a;for(a=0;a<16;a++)C[a]=j[a];for(a=253;a>=0;a--)c(C,C),a!==2&&a!==4&&s(C,C,j);for(a=0;a<16;a++)L[a]=C[a]}function o(L,j){const C=n();let a;for(a=0;a<16;a++)C[a]=j[a];for(a=250;a>=0;a--)c(C,C),a!==1&&s(C,C,j);for(a=0;a<16;a++)L[a]=C[a]}function d(L,j){const C=n(),a=n(),P=n(),Y=n(),J=n(),fe=n(),_e=n(),de=n(),we=n();w(C,L[1],L[0]),w(we,j[1],j[0]),s(C,C,we),y(a,L[0],L[1]),y(we,j[0],j[1]),s(a,a,we),s(P,L[3],j[3]),s(P,P,O),s(Y,L[2],j[2]),y(Y,Y,Y),w(J,a,C),w(fe,Y,P),y(_e,Y,P),y(de,a,C),s(L[0],J,fe),s(L[1],de,_e),s(L[2],_e,fe),s(L[3],J,de)}function p(L,j,C){for(let a=0;a<4;a++)q(L[a],j[a],C)}function D(L,j){const C=n(),a=n(),P=n();H(P,j[2]),s(C,j[0],P),s(a,j[1],P),F(L,a),L[31]^=b(C)<<7}function m(L,j,C){N(L[0],E),N(L[1],f),N(L[2],f),N(L[3],E);for(let a=255;a>=0;--a){const P=C[a/8|0]>>(a&7)&1;p(L,j,P),d(j,L),d(L,L),p(L,j,P)}}function l(L,j){const C=[n(),n(),n(),n()];N(C[0],v),N(C[1],x),N(C[2],f),s(C[3],v,x),m(L,C,j)}function T(L){if(L.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const j=(0,r.hash)(L);j[0]&=248,j[31]&=127,j[31]|=64;const C=new Uint8Array(32),a=[n(),n(),n(),n()];l(a,j),D(C,a);const P=new Uint8Array(64);return P.set(L),P.set(C,32),{publicKey:C,secretKey:P}}t.generateKeyPairFromSeed=T;function R(L){const j=(0,e.randomBytes)(32,L),C=T(j);return(0,i.wipe)(j),C}t.generateKeyPair=R;function z(L){if(L.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(L.subarray(32))}t.extractPublicKeyFromSecretKey=z;const I=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function M(L,j){let C,a,P,Y;for(a=63;a>=32;--a){for(C=0,P=a-32,Y=a-12;P<Y;++P)j[P]+=C-16*j[a]*I[P-(a-32)],C=Math.floor((j[P]+128)/256),j[P]-=C*256;j[P]+=C,j[a]=0}for(C=0,P=0;P<32;P++)j[P]+=C-(j[31]>>4)*I[P],C=j[P]>>8,j[P]&=255;for(P=0;P<32;P++)j[P]-=C*I[P];for(a=0;a<32;a++)j[a+1]+=j[a]>>8,L[a]=j[a]&255}function K(L){const j=new Float64Array(64);for(let C=0;C<64;C++)j[C]=L[C];for(let C=0;C<64;C++)L[C]=0;M(L,j)}function G(L,j){const C=new Float64Array(64),a=[n(),n(),n(),n()],P=(0,r.hash)(L.subarray(0,32));P[0]&=248,P[31]&=127,P[31]|=64;const Y=new Uint8Array(64);Y.set(P.subarray(32),32);const J=new r.SHA512;J.update(Y.subarray(32)),J.update(j);const fe=J.digest();J.clean(),K(fe),l(a,fe),D(Y,a),J.reset(),J.update(Y.subarray(0,32)),J.update(L.subarray(32)),J.update(j);const _e=J.digest();K(_e);for(let de=0;de<32;de++)C[de]=fe[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)C[de+we]+=_e[de]*P[we];return M(Y.subarray(32),C),Y}t.sign=G;function V(L,j){const C=n(),a=n(),P=n(),Y=n(),J=n(),fe=n(),_e=n();return N(L[2],f),g(L[1],j),c(P,L[1]),s(Y,P,_),w(P,P,L[2]),y(Y,L[2],Y),c(J,Y),c(fe,J),s(_e,fe,J),s(C,_e,P),s(C,C,Y),o(C,C),s(C,C,P),s(C,C,Y),s(C,C,Y),s(L[0],C,Y),c(a,L[0]),s(a,a,Y),u(a,P)&&s(L[0],L[0],$),c(a,L[0]),s(a,a,Y),u(a,P)?-1:(b(L[0])===j[31]>>7&&w(L[0],E,L[0]),s(L[3],L[0],L[1]),0)}function Z(L,j,C){const a=new Uint8Array(32),P=[n(),n(),n(),n()],Y=[n(),n(),n(),n()];if(C.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(V(Y,L))return!1;const J=new r.SHA512;J.update(C.subarray(0,32)),J.update(L),J.update(j);const fe=J.digest();return K(fe),m(P,Y,fe),l(Y,C.subarray(32)),d(P,Y),D(a,P),!B(C,a)}t.verify=Z;function W(L){let j=[n(),n(),n(),n()];if(V(j,L))throw new Error("Ed25519: invalid public key");let C=n(),a=n(),P=j[1];y(C,f,P),w(a,f,P),H(a,a),s(C,C,a);let Y=new Uint8Array(32);return F(Y,C),Y}t.convertPublicKeyToX25519=W;function oe(L){const j=(0,r.hash)(L.subarray(0,32));j[0]&=248,j[31]&=127,j[31]|=64;const C=new Uint8Array(j.subarray(0,32));return(0,i.wipe)(j),C}t.convertSecretKeyToX25519=oe})(Zi);const _u="EdDSA",bu="JWT",ha=".",fa="base64url",mu="utf8",wu="utf8",Eu=":",vu="did",Du="key",es="base58btc",Su="z",Ou="K36",Iu=32;function Qi(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function la(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Qi(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function xu(t,e){e||(e=t.reduce((n,h)=>n+h.length,0));const r=la(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return Qi(r)}function Pu(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var h=t.charAt(n),E=h.charCodeAt(0);if(r[E]!==255)throw new TypeError(h+" is ambiguous");r[E]=n}var f=t.length,_=t.charAt(0),O=Math.log(f)/Math.log(256),v=Math.log(256)/Math.log(f);function x(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var q=0,F=0,B=0,u=A.length;B!==u&&A[B]===0;)B++,q++;for(var b=(u-B)*v+1>>>0,g=new Uint8Array(b);B!==u;){for(var y=A[B],w=0,s=b-1;(y!==0||w<F)&&s!==-1;s--,w++)y+=256*g[s]>>>0,g[s]=y%f>>>0,y=y/f>>>0;if(y!==0)throw new Error("Non-zero carry");F=w,B++}for(var c=b-F;c!==b&&g[c]===0;)c++;for(var H=_.repeat(q);c<b;++c)H+=t.charAt(g[c]);return H}function $(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var q=0;if(A[q]!==" "){for(var F=0,B=0;A[q]===_;)F++,q++;for(var u=(A.length-q)*O+1>>>0,b=new Uint8Array(u);A[q];){var g=r[A.charCodeAt(q)];if(g===255)return;for(var y=0,w=u-1;(g!==0||y<B)&&w!==-1;w--,y++)g+=f*b[w]>>>0,b[w]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");B=y,q++}if(A[q]!==" "){for(var s=u-B;s!==u&&b[s]===0;)s++;for(var c=new Uint8Array(F+(u-s)),H=F;s!==u;)c[H++]=b[s++];return c}}}function N(A){var q=$(A);if(q)return q;throw new Error(`Non-${e} character`)}return{encode:x,decodeUnsafe:$,decode:N}}var Tu=Pu,Au=Tu;const Nu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Cu=t=>new TextEncoder().encode(t),Uu=t=>new TextDecoder().decode(t);class Ru{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Fu{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return da(this,e)}}class ju{constructor(e){this.decoders=e}or(e){return da(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const da=(t,e)=>new ju({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Lu{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Ru(e,r,i),this.decoder=new Fu(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ri=({name:t,prefix:e,encode:r,decode:i})=>new Lu(t,e,r,i),Sr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Au(r,e);return ri({prefix:t,name:e,encode:i,decode:h=>Nu(n(h))})},$u=(t,e,r,i)=>{const n={};for(let v=0;v<e.length;++v)n[e[v]]=v;let h=t.length;for(;t[h-1]==="=";)--h;const E=new Uint8Array(h*r/8|0);let f=0,_=0,O=0;for(let v=0;v<h;++v){const x=n[t[v]];if(x===void 0)throw new SyntaxError(`Non-${i} character`);_=_<<r|x,f+=r,f>=8&&(f-=8,E[O++]=255&_>>f)}if(f>=r||255&_<<8-f)throw new SyntaxError("Unexpected end of data");return E},Mu=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let h="",E=0,f=0;for(let _=0;_<t.length;++_)for(f=f<<8|t[_],E+=8;E>r;)E-=r,h+=e[n&f>>E];if(E&&(h+=e[n&f<<r-E]),i)for(;h.length*r&7;)h+="=";return h},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ri({prefix:e,name:t,encode(n){return Mu(n,i,r)},decode(n){return $u(n,i,r,t)}}),Hu=ri({prefix:"\0",name:"identity",encode:t=>Uu(t),decode:t=>Cu(t)}),zu=Object.freeze(Object.defineProperty({__proto__:null,identity:Hu},Symbol.toStringTag,{value:"Module"})),qu=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Bu=Object.freeze(Object.defineProperty({__proto__:null,base2:qu},Symbol.toStringTag,{value:"Module"})),Ku=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Vu=Object.freeze(Object.defineProperty({__proto__:null,base8:Ku},Symbol.toStringTag,{value:"Module"})),Gu=Sr({prefix:"9",name:"base10",alphabet:"0123456789"}),ku=Object.freeze(Object.defineProperty({__proto__:null,base10:Gu},Symbol.toStringTag,{value:"Module"})),Yu=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Wu=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ju=Object.freeze(Object.defineProperty({__proto__:null,base16:Yu,base16upper:Wu},Symbol.toStringTag,{value:"Module"})),Xu=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Zu=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qu=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),eh=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),th=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),rh=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ih=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),nh=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),sh=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ah=Object.freeze(Object.defineProperty({__proto__:null,base32:Xu,base32hex:th,base32hexpad:ih,base32hexpadupper:nh,base32hexupper:rh,base32pad:Qu,base32padupper:eh,base32upper:Zu,base32z:sh},Symbol.toStringTag,{value:"Module"})),oh=Sr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ch=Sr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),uh=Object.freeze(Object.defineProperty({__proto__:null,base36:oh,base36upper:ch},Symbol.toStringTag,{value:"Module"})),hh=Sr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fh=Sr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),lh=Object.freeze(Object.defineProperty({__proto__:null,base58btc:hh,base58flickr:fh},Symbol.toStringTag,{value:"Module"})),dh=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),gh=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ph=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yh=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),_h=Object.freeze(Object.defineProperty({__proto__:null,base64:dh,base64pad:gh,base64url:ph,base64urlpad:yh},Symbol.toStringTag,{value:"Module"})),ga=Array.from(""),bh=ga.reduce((t,e,r)=>(t[r]=e,t),[]),mh=ga.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function wh(t){return t.reduce((e,r)=>(e+=bh[r],e),"")}function Eh(t){const e=[];for(const r of t){const i=mh[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const vh=ri({prefix:"",name:"base256emoji",encode:wh,decode:Eh}),Dh=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:vh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Vr={...zu,...Bu,...Vu,...ku,...Ju,...ah,...uh,...lh,..._h,...Dh};function pa(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ts=pa("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),bi=pa("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=la(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),ya={utf8:ts,"utf-8":ts,hex:Vr.base16,latin1:bi,ascii:bi,binary:bi,...Vr};function en(t,e="utf8"){const r=ya[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function tn(t,e="utf8"){const r=ya[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Qi(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Gr(t){return en(tn(Bi(t),mu),fa)}function _a(t){const e=tn(Ou,es),r=Su+en(xu([e,t]),es);return[vu,Du,r].join(Eu)}function Sh(t){return en(t,fa)}function Oh(t){return tn([Gr(t.header),Gr(t.payload)].join(ha),wu)}function Ih(t){return[Gr(t.header),Gr(t.payload),Sh(t.signature)].join(ha)}function rs(t=rr.randomBytes(Iu)){return Zi.generateKeyPairFromSeed(t)}async function xh(t,e,r,i,n=Q.fromMiliseconds(Date.now())){const h={alg:_u,typ:bu},E=_a(i.publicKey),f=n+r,_={iss:E,sub:t,aud:e,iat:n,exp:f},O=Oh({header:h,payload:_}),v=Zi.sign(i.secretKey,O);return Ih({header:h,payload:_,signature:v})}var rn={},ii={};Object.defineProperty(ii,"__esModule",{value:!0});var Qe=ie,Ri=ct,Ph=20;function Th(t,e,r){for(var i=1634760805,n=857760878,h=2036477234,E=1797285236,f=r[3]<<24|r[2]<<16|r[1]<<8|r[0],_=r[7]<<24|r[6]<<16|r[5]<<8|r[4],O=r[11]<<24|r[10]<<16|r[9]<<8|r[8],v=r[15]<<24|r[14]<<16|r[13]<<8|r[12],x=r[19]<<24|r[18]<<16|r[17]<<8|r[16],$=r[23]<<24|r[22]<<16|r[21]<<8|r[20],N=r[27]<<24|r[26]<<16|r[25]<<8|r[24],A=r[31]<<24|r[30]<<16|r[29]<<8|r[28],q=e[3]<<24|e[2]<<16|e[1]<<8|e[0],F=e[7]<<24|e[6]<<16|e[5]<<8|e[4],B=e[11]<<24|e[10]<<16|e[9]<<8|e[8],u=e[15]<<24|e[14]<<16|e[13]<<8|e[12],b=i,g=n,y=h,w=E,s=f,c=_,H=O,o=v,d=x,p=$,D=N,m=A,l=q,T=F,R=B,z=u,I=0;I<Ph;I+=2)b=b+s|0,l^=b,l=l>>>32-16|l<<16,d=d+l|0,s^=d,s=s>>>32-12|s<<12,g=g+c|0,T^=g,T=T>>>32-16|T<<16,p=p+T|0,c^=p,c=c>>>32-12|c<<12,y=y+H|0,R^=y,R=R>>>32-16|R<<16,D=D+R|0,H^=D,H=H>>>32-12|H<<12,w=w+o|0,z^=w,z=z>>>32-16|z<<16,m=m+z|0,o^=m,o=o>>>32-12|o<<12,y=y+H|0,R^=y,R=R>>>32-8|R<<8,D=D+R|0,H^=D,H=H>>>32-7|H<<7,w=w+o|0,z^=w,z=z>>>32-8|z<<8,m=m+z|0,o^=m,o=o>>>32-7|o<<7,g=g+c|0,T^=g,T=T>>>32-8|T<<8,p=p+T|0,c^=p,c=c>>>32-7|c<<7,b=b+s|0,l^=b,l=l>>>32-8|l<<8,d=d+l|0,s^=d,s=s>>>32-7|s<<7,b=b+c|0,z^=b,z=z>>>32-16|z<<16,D=D+z|0,c^=D,c=c>>>32-12|c<<12,g=g+H|0,l^=g,l=l>>>32-16|l<<16,m=m+l|0,H^=m,H=H>>>32-12|H<<12,y=y+o|0,T^=y,T=T>>>32-16|T<<16,d=d+T|0,o^=d,o=o>>>32-12|o<<12,w=w+s|0,R^=w,R=R>>>32-16|R<<16,p=p+R|0,s^=p,s=s>>>32-12|s<<12,y=y+o|0,T^=y,T=T>>>32-8|T<<8,d=d+T|0,o^=d,o=o>>>32-7|o<<7,w=w+s|0,R^=w,R=R>>>32-8|R<<8,p=p+R|0,s^=p,s=s>>>32-7|s<<7,g=g+H|0,l^=g,l=l>>>32-8|l<<8,m=m+l|0,H^=m,H=H>>>32-7|H<<7,b=b+c|0,z^=b,z=z>>>32-8|z<<8,D=D+z|0,c^=D,c=c>>>32-7|c<<7;Qe.writeUint32LE(b+i|0,t,0),Qe.writeUint32LE(g+n|0,t,4),Qe.writeUint32LE(y+h|0,t,8),Qe.writeUint32LE(w+E|0,t,12),Qe.writeUint32LE(s+f|0,t,16),Qe.writeUint32LE(c+_|0,t,20),Qe.writeUint32LE(H+O|0,t,24),Qe.writeUint32LE(o+v|0,t,28),Qe.writeUint32LE(d+x|0,t,32),Qe.writeUint32LE(p+$|0,t,36),Qe.writeUint32LE(D+N|0,t,40),Qe.writeUint32LE(m+A|0,t,44),Qe.writeUint32LE(l+q|0,t,48),Qe.writeUint32LE(T+F|0,t,52),Qe.writeUint32LE(R+B|0,t,56),Qe.writeUint32LE(z+u|0,t,60)}function ba(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var h,E;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");h=new Uint8Array(16),E=h.length-e.length,h.set(e,E)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");h=e,E=n}for(var f=new Uint8Array(64),_=0;_<r.length;_+=64){Th(f,h,t);for(var O=_;O<_+64&&O<r.length;O++)i[O]=r[O]^f[O-_];Nh(h,0,E)}return Ri.wipe(f),n===0&&Ri.wipe(h),i}ii.streamXOR=ba;function Ah(t,e,r,i){return i===void 0&&(i=0),Ri.wipe(r),ba(t,e,r,r,i)}ii.stream=Ah;function Nh(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ma={},jt={};Object.defineProperty(jt,"__esModule",{value:!0});function Ch(t,e,r){return~(t-1)&e|t-1&r}jt.select=Ch;function Uh(t,e){return(t|0)-(e|0)-1>>>31&1}jt.lessOrEqual=Uh;function wa(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}jt.compare=wa;function Rh(t,e){return t.length===0||e.length===0?!1:wa(t,e)!==0}jt.equal=Rh;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=jt,r=ct;t.DIGEST_LENGTH=16;var i=function(){function E(f){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var _=f[0]|f[1]<<8;this._r[0]=_&8191;var O=f[2]|f[3]<<8;this._r[1]=(_>>>13|O<<3)&8191;var v=f[4]|f[5]<<8;this._r[2]=(O>>>10|v<<6)&7939;var x=f[6]|f[7]<<8;this._r[3]=(v>>>7|x<<9)&8191;var $=f[8]|f[9]<<8;this._r[4]=(x>>>4|$<<12)&255,this._r[5]=$>>>1&8190;var N=f[10]|f[11]<<8;this._r[6]=($>>>14|N<<2)&8191;var A=f[12]|f[13]<<8;this._r[7]=(N>>>11|A<<5)&8065;var q=f[14]|f[15]<<8;this._r[8]=(A>>>8|q<<8)&8191,this._r[9]=q>>>5&127,this._pad[0]=f[16]|f[17]<<8,this._pad[1]=f[18]|f[19]<<8,this._pad[2]=f[20]|f[21]<<8,this._pad[3]=f[22]|f[23]<<8,this._pad[4]=f[24]|f[25]<<8,this._pad[5]=f[26]|f[27]<<8,this._pad[6]=f[28]|f[29]<<8,this._pad[7]=f[30]|f[31]<<8}return E.prototype._blocks=function(f,_,O){for(var v=this._fin?0:2048,x=this._h[0],$=this._h[1],N=this._h[2],A=this._h[3],q=this._h[4],F=this._h[5],B=this._h[6],u=this._h[7],b=this._h[8],g=this._h[9],y=this._r[0],w=this._r[1],s=this._r[2],c=this._r[3],H=this._r[4],o=this._r[5],d=this._r[6],p=this._r[7],D=this._r[8],m=this._r[9];O>=16;){var l=f[_+0]|f[_+1]<<8;x+=l&8191;var T=f[_+2]|f[_+3]<<8;$+=(l>>>13|T<<3)&8191;var R=f[_+4]|f[_+5]<<8;N+=(T>>>10|R<<6)&8191;var z=f[_+6]|f[_+7]<<8;A+=(R>>>7|z<<9)&8191;var I=f[_+8]|f[_+9]<<8;q+=(z>>>4|I<<12)&8191,F+=I>>>1&8191;var M=f[_+10]|f[_+11]<<8;B+=(I>>>14|M<<2)&8191;var K=f[_+12]|f[_+13]<<8;u+=(M>>>11|K<<5)&8191;var G=f[_+14]|f[_+15]<<8;b+=(K>>>8|G<<8)&8191,g+=G>>>5|v;var V=0,Z=V;Z+=x*y,Z+=$*(5*m),Z+=N*(5*D),Z+=A*(5*p),Z+=q*(5*d),V=Z>>>13,Z&=8191,Z+=F*(5*o),Z+=B*(5*H),Z+=u*(5*c),Z+=b*(5*s),Z+=g*(5*w),V+=Z>>>13,Z&=8191;var W=V;W+=x*w,W+=$*y,W+=N*(5*m),W+=A*(5*D),W+=q*(5*p),V=W>>>13,W&=8191,W+=F*(5*d),W+=B*(5*o),W+=u*(5*H),W+=b*(5*c),W+=g*(5*s),V+=W>>>13,W&=8191;var oe=V;oe+=x*s,oe+=$*w,oe+=N*y,oe+=A*(5*m),oe+=q*(5*D),V=oe>>>13,oe&=8191,oe+=F*(5*p),oe+=B*(5*d),oe+=u*(5*o),oe+=b*(5*H),oe+=g*(5*c),V+=oe>>>13,oe&=8191;var L=V;L+=x*c,L+=$*s,L+=N*w,L+=A*y,L+=q*(5*m),V=L>>>13,L&=8191,L+=F*(5*D),L+=B*(5*p),L+=u*(5*d),L+=b*(5*o),L+=g*(5*H),V+=L>>>13,L&=8191;var j=V;j+=x*H,j+=$*c,j+=N*s,j+=A*w,j+=q*y,V=j>>>13,j&=8191,j+=F*(5*m),j+=B*(5*D),j+=u*(5*p),j+=b*(5*d),j+=g*(5*o),V+=j>>>13,j&=8191;var C=V;C+=x*o,C+=$*H,C+=N*c,C+=A*s,C+=q*w,V=C>>>13,C&=8191,C+=F*y,C+=B*(5*m),C+=u*(5*D),C+=b*(5*p),C+=g*(5*d),V+=C>>>13,C&=8191;var a=V;a+=x*d,a+=$*o,a+=N*H,a+=A*c,a+=q*s,V=a>>>13,a&=8191,a+=F*w,a+=B*y,a+=u*(5*m),a+=b*(5*D),a+=g*(5*p),V+=a>>>13,a&=8191;var P=V;P+=x*p,P+=$*d,P+=N*o,P+=A*H,P+=q*c,V=P>>>13,P&=8191,P+=F*s,P+=B*w,P+=u*y,P+=b*(5*m),P+=g*(5*D),V+=P>>>13,P&=8191;var Y=V;Y+=x*D,Y+=$*p,Y+=N*d,Y+=A*o,Y+=q*H,V=Y>>>13,Y&=8191,Y+=F*c,Y+=B*s,Y+=u*w,Y+=b*y,Y+=g*(5*m),V+=Y>>>13,Y&=8191;var J=V;J+=x*m,J+=$*D,J+=N*p,J+=A*d,J+=q*o,V=J>>>13,J&=8191,J+=F*H,J+=B*c,J+=u*s,J+=b*w,J+=g*y,V+=J>>>13,J&=8191,V=(V<<2)+V|0,V=V+Z|0,Z=V&8191,V=V>>>13,W+=V,x=Z,$=W,N=oe,A=L,q=j,F=C,B=a,u=P,b=Y,g=J,_+=16,O-=16}this._h[0]=x,this._h[1]=$,this._h[2]=N,this._h[3]=A,this._h[4]=q,this._h[5]=F,this._h[6]=B,this._h[7]=u,this._h[8]=b,this._h[9]=g},E.prototype.finish=function(f,_){_===void 0&&(_=0);var O=new Uint16Array(10),v,x,$,N;if(this._leftover){for(N=this._leftover,this._buffer[N++]=1;N<16;N++)this._buffer[N]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(v=this._h[1]>>>13,this._h[1]&=8191,N=2;N<10;N++)this._h[N]+=v,v=this._h[N]>>>13,this._h[N]&=8191;for(this._h[0]+=v*5,v=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=v,v=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=v,O[0]=this._h[0]+5,v=O[0]>>>13,O[0]&=8191,N=1;N<10;N++)O[N]=this._h[N]+v,v=O[N]>>>13,O[N]&=8191;for(O[9]-=1<<13,x=(v^1)-1,N=0;N<10;N++)O[N]&=x;for(x=~x,N=0;N<10;N++)this._h[N]=this._h[N]&x|O[N];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,$=this._h[0]+this._pad[0],this._h[0]=$&65535,N=1;N<8;N++)$=(this._h[N]+this._pad[N]|0)+($>>>16)|0,this._h[N]=$&65535;return f[_+0]=this._h[0]>>>0,f[_+1]=this._h[0]>>>8,f[_+2]=this._h[1]>>>0,f[_+3]=this._h[1]>>>8,f[_+4]=this._h[2]>>>0,f[_+5]=this._h[2]>>>8,f[_+6]=this._h[3]>>>0,f[_+7]=this._h[3]>>>8,f[_+8]=this._h[4]>>>0,f[_+9]=this._h[4]>>>8,f[_+10]=this._h[5]>>>0,f[_+11]=this._h[5]>>>8,f[_+12]=this._h[6]>>>0,f[_+13]=this._h[6]>>>8,f[_+14]=this._h[7]>>>0,f[_+15]=this._h[7]>>>8,this._finished=!0,this},E.prototype.update=function(f){var _=0,O=f.length,v;if(this._leftover){v=16-this._leftover,v>O&&(v=O);for(var x=0;x<v;x++)this._buffer[this._leftover+x]=f[_+x];if(O-=v,_+=v,this._leftover+=v,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(O>=16&&(v=O-O%16,this._blocks(f,_,v),_+=v,O-=v),O){for(var x=0;x<O;x++)this._buffer[this._leftover+x]=f[_+x];this._leftover+=O}return this},E.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var f=new Uint8Array(16);return this.finish(f),f},E.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},E}();t.Poly1305=i;function n(E,f){var _=new i(E);_.update(f);var O=_.digest();return _.clean(),O}t.oneTimeAuth=n;function h(E,f){return E.length!==t.DIGEST_LENGTH||f.length!==t.DIGEST_LENGTH?!1:e.equal(E,f)}t.equal=h})(ma);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ii,r=ma,i=ct,n=ie,h=jt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var E=new Uint8Array(16),f=function(){function _(O){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,O.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(O)}return _.prototype.seal=function(O,v,x,$){if(O.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var N=new Uint8Array(16);N.set(O,N.length-O.length);var A=new Uint8Array(32);e.stream(this._key,N,A,4);var q=v.length+this.tagLength,F;if($){if($.length!==q)throw new Error("ChaCha20Poly1305: incorrect destination length");F=$}else F=new Uint8Array(q);return e.streamXOR(this._key,N,v,F,4),this._authenticate(F.subarray(F.length-this.tagLength,F.length),A,F.subarray(0,F.length-this.tagLength),x),i.wipe(N),F},_.prototype.open=function(O,v,x,$){if(O.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(v.length<this.tagLength)return null;var N=new Uint8Array(16);N.set(O,N.length-O.length);var A=new Uint8Array(32);e.stream(this._key,N,A,4);var q=new Uint8Array(this.tagLength);if(this._authenticate(q,A,v.subarray(0,v.length-this.tagLength),x),!h.equal(q,v.subarray(v.length-this.tagLength,v.length)))return null;var F=v.length-this.tagLength,B;if($){if($.length!==F)throw new Error("ChaCha20Poly1305: incorrect destination length");B=$}else B=new Uint8Array(F);return e.streamXOR(this._key,N,v.subarray(0,v.length-this.tagLength),B,4),i.wipe(N),B},_.prototype.clean=function(){return i.wipe(this._key),this},_.prototype._authenticate=function(O,v,x,$){var N=new r.Poly1305(v);$&&(N.update($),$.length%16>0&&N.update(E.subarray($.length%16))),N.update(x),x.length%16>0&&N.update(E.subarray(x.length%16));var A=new Uint8Array(8);$&&n.writeUint64LE($.length,A),N.update(A),n.writeUint64LE(x.length,A),N.update(A);for(var q=N.digest(),F=0;F<q.length;F++)O[F]=q[F];N.clean(),i.wipe(q),i.wipe(A)},_}();t.ChaCha20Poly1305=f})(rn);var Ea={},Or={},nn={};Object.defineProperty(nn,"__esModule",{value:!0});function Fh(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}nn.isSerializableHash=Fh;Object.defineProperty(Or,"__esModule",{value:!0});var mt=nn,jh=jt,Lh=ct,va=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),mt.isSerializableHash(this._inner)&&mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Lh.wipe(i)}return t.prototype.reset=function(){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Or.HMAC=va;function $h(t,e,r){var i=new va(t,e);i.update(r);var n=i.digest();return i.clean(),n}Or.hmac=$h;Or.equal=jh.equal;Object.defineProperty(Ea,"__esModule",{value:!0});var is=Or,ns=ct,Mh=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var h=is.hmac(this._hash,i,r);this._hmac=new is.HMAC(e,h),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),ns.wipe(this._buffer),ns.wipe(this._counter),this._bufpos=0},t}(),Hh=Ea.HKDF=Mh,ni={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=ct;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function f(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return f.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},f.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},f.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},f.prototype.update=function(_,O){if(O===void 0&&(O=_.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var v=0;if(this._bytesHashed+=O,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&O>0;)this._buffer[this._bufferLength++]=_[v++],O--;this._bufferLength===this.blockSize&&(h(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(O>=this.blockSize&&(v=h(this._temp,this._state,_,v,O),O%=this.blockSize);O>0;)this._buffer[this._bufferLength++]=_[v++],O--;return this},f.prototype.finish=function(_){if(!this._finished){var O=this._bytesHashed,v=this._bufferLength,x=O/536870912|0,$=O<<3,N=O%64<56?64:128;this._buffer[v]=128;for(var A=v+1;A<N-8;A++)this._buffer[A]=0;e.writeUint32BE(x,this._buffer,N-8),e.writeUint32BE($,this._buffer,N-4),h(this._temp,this._state,this._buffer,0,N),this._finished=!0}for(var A=0;A<this.digestLength/4;A++)e.writeUint32BE(this._state[A],_,A*4);return this},f.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},f.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},f.prototype.restoreState=function(_){return this._state.set(_.state),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},f.prototype.cleanSavedState=function(_){r.wipe(_.state),_.buffer&&r.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},f}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function h(f,_,O,v,x){for(;x>=64;){for(var $=_[0],N=_[1],A=_[2],q=_[3],F=_[4],B=_[5],u=_[6],b=_[7],g=0;g<16;g++){var y=v+g*4;f[g]=e.readUint32BE(O,y)}for(var g=16;g<64;g++){var w=f[g-2],s=(w>>>17|w<<32-17)^(w>>>19|w<<32-19)^w>>>10;w=f[g-15];var c=(w>>>7|w<<32-7)^(w>>>18|w<<32-18)^w>>>3;f[g]=(s+f[g-7]|0)+(c+f[g-16]|0)}for(var g=0;g<64;g++){var s=(((F>>>6|F<<26)^(F>>>11|F<<21)^(F>>>25|F<<7))+(F&B^~F&u)|0)+(b+(n[g]+f[g]|0)|0)|0,c=(($>>>2|$<<32-2)^($>>>13|$<<32-13)^($>>>22|$<<32-22))+($&N^$&A^N&A)|0;b=u,u=B,B=F,F=q+s|0,q=A,A=N,N=$,$=s+c|0}_[0]+=$,_[1]+=N,_[2]+=A,_[3]+=q,_[4]+=F,_[5]+=B,_[6]+=u,_[7]+=b,v+=64,x-=64}return v}function E(f){var _=new i;_.update(f);var O=_.digest();return _.clean(),O}t.hash=E})(ni);var sn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=rr,r=ct;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(g){const y=new Float64Array(16);if(g)for(let w=0;w<g.length;w++)y[w]=g[w];return y}const n=new Uint8Array(32);n[0]=9;const h=i([56129,1]);function E(g){let y=1;for(let w=0;w<16;w++){let s=g[w]+y+65535;y=Math.floor(s/65536),g[w]=s-y*65536}g[0]+=y-1+37*(y-1)}function f(g,y,w){const s=~(w-1);for(let c=0;c<16;c++){const H=s&(g[c]^y[c]);g[c]^=H,y[c]^=H}}function _(g,y){const w=i(),s=i();for(let c=0;c<16;c++)s[c]=y[c];E(s),E(s),E(s);for(let c=0;c<2;c++){w[0]=s[0]-65517;for(let o=1;o<15;o++)w[o]=s[o]-65535-(w[o-1]>>16&1),w[o-1]&=65535;w[15]=s[15]-32767-(w[14]>>16&1);const H=w[15]>>16&1;w[14]&=65535,f(s,w,1-H)}for(let c=0;c<16;c++)g[2*c]=s[c]&255,g[2*c+1]=s[c]>>8}function O(g,y){for(let w=0;w<16;w++)g[w]=y[2*w]+(y[2*w+1]<<8);g[15]&=32767}function v(g,y,w){for(let s=0;s<16;s++)g[s]=y[s]+w[s]}function x(g,y,w){for(let s=0;s<16;s++)g[s]=y[s]-w[s]}function $(g,y,w){let s,c,H=0,o=0,d=0,p=0,D=0,m=0,l=0,T=0,R=0,z=0,I=0,M=0,K=0,G=0,V=0,Z=0,W=0,oe=0,L=0,j=0,C=0,a=0,P=0,Y=0,J=0,fe=0,_e=0,de=0,we=0,Ue=0,Te=0,ye=w[0],ge=w[1],le=w[2],ue=w[3],ce=w[4],ae=w[5],se=w[6],te=w[7],he=w[8],pe=w[9],re=w[10],be=w[11],me=w[12],ve=w[13],De=w[14],Ee=w[15];s=y[0],H+=s*ye,o+=s*ge,d+=s*le,p+=s*ue,D+=s*ce,m+=s*ae,l+=s*se,T+=s*te,R+=s*he,z+=s*pe,I+=s*re,M+=s*be,K+=s*me,G+=s*ve,V+=s*De,Z+=s*Ee,s=y[1],o+=s*ye,d+=s*ge,p+=s*le,D+=s*ue,m+=s*ce,l+=s*ae,T+=s*se,R+=s*te,z+=s*he,I+=s*pe,M+=s*re,K+=s*be,G+=s*me,V+=s*ve,Z+=s*De,W+=s*Ee,s=y[2],d+=s*ye,p+=s*ge,D+=s*le,m+=s*ue,l+=s*ce,T+=s*ae,R+=s*se,z+=s*te,I+=s*he,M+=s*pe,K+=s*re,G+=s*be,V+=s*me,Z+=s*ve,W+=s*De,oe+=s*Ee,s=y[3],p+=s*ye,D+=s*ge,m+=s*le,l+=s*ue,T+=s*ce,R+=s*ae,z+=s*se,I+=s*te,M+=s*he,K+=s*pe,G+=s*re,V+=s*be,Z+=s*me,W+=s*ve,oe+=s*De,L+=s*Ee,s=y[4],D+=s*ye,m+=s*ge,l+=s*le,T+=s*ue,R+=s*ce,z+=s*ae,I+=s*se,M+=s*te,K+=s*he,G+=s*pe,V+=s*re,Z+=s*be,W+=s*me,oe+=s*ve,L+=s*De,j+=s*Ee,s=y[5],m+=s*ye,l+=s*ge,T+=s*le,R+=s*ue,z+=s*ce,I+=s*ae,M+=s*se,K+=s*te,G+=s*he,V+=s*pe,Z+=s*re,W+=s*be,oe+=s*me,L+=s*ve,j+=s*De,C+=s*Ee,s=y[6],l+=s*ye,T+=s*ge,R+=s*le,z+=s*ue,I+=s*ce,M+=s*ae,K+=s*se,G+=s*te,V+=s*he,Z+=s*pe,W+=s*re,oe+=s*be,L+=s*me,j+=s*ve,C+=s*De,a+=s*Ee,s=y[7],T+=s*ye,R+=s*ge,z+=s*le,I+=s*ue,M+=s*ce,K+=s*ae,G+=s*se,V+=s*te,Z+=s*he,W+=s*pe,oe+=s*re,L+=s*be,j+=s*me,C+=s*ve,a+=s*De,P+=s*Ee,s=y[8],R+=s*ye,z+=s*ge,I+=s*le,M+=s*ue,K+=s*ce,G+=s*ae,V+=s*se,Z+=s*te,W+=s*he,oe+=s*pe,L+=s*re,j+=s*be,C+=s*me,a+=s*ve,P+=s*De,Y+=s*Ee,s=y[9],z+=s*ye,I+=s*ge,M+=s*le,K+=s*ue,G+=s*ce,V+=s*ae,Z+=s*se,W+=s*te,oe+=s*he,L+=s*pe,j+=s*re,C+=s*be,a+=s*me,P+=s*ve,Y+=s*De,J+=s*Ee,s=y[10],I+=s*ye,M+=s*ge,K+=s*le,G+=s*ue,V+=s*ce,Z+=s*ae,W+=s*se,oe+=s*te,L+=s*he,j+=s*pe,C+=s*re,a+=s*be,P+=s*me,Y+=s*ve,J+=s*De,fe+=s*Ee,s=y[11],M+=s*ye,K+=s*ge,G+=s*le,V+=s*ue,Z+=s*ce,W+=s*ae,oe+=s*se,L+=s*te,j+=s*he,C+=s*pe,a+=s*re,P+=s*be,Y+=s*me,J+=s*ve,fe+=s*De,_e+=s*Ee,s=y[12],K+=s*ye,G+=s*ge,V+=s*le,Z+=s*ue,W+=s*ce,oe+=s*ae,L+=s*se,j+=s*te,C+=s*he,a+=s*pe,P+=s*re,Y+=s*be,J+=s*me,fe+=s*ve,_e+=s*De,de+=s*Ee,s=y[13],G+=s*ye,V+=s*ge,Z+=s*le,W+=s*ue,oe+=s*ce,L+=s*ae,j+=s*se,C+=s*te,a+=s*he,P+=s*pe,Y+=s*re,J+=s*be,fe+=s*me,_e+=s*ve,de+=s*De,we+=s*Ee,s=y[14],V+=s*ye,Z+=s*ge,W+=s*le,oe+=s*ue,L+=s*ce,j+=s*ae,C+=s*se,a+=s*te,P+=s*he,Y+=s*pe,J+=s*re,fe+=s*be,_e+=s*me,de+=s*ve,we+=s*De,Ue+=s*Ee,s=y[15],Z+=s*ye,W+=s*ge,oe+=s*le,L+=s*ue,j+=s*ce,C+=s*ae,a+=s*se,P+=s*te,Y+=s*he,J+=s*pe,fe+=s*re,_e+=s*be,de+=s*me,we+=s*ve,Ue+=s*De,Te+=s*Ee,H+=38*W,o+=38*oe,d+=38*L,p+=38*j,D+=38*C,m+=38*a,l+=38*P,T+=38*Y,R+=38*J,z+=38*fe,I+=38*_e,M+=38*de,K+=38*we,G+=38*Ue,V+=38*Te,c=1,s=H+c+65535,c=Math.floor(s/65536),H=s-c*65536,s=o+c+65535,c=Math.floor(s/65536),o=s-c*65536,s=d+c+65535,c=Math.floor(s/65536),d=s-c*65536,s=p+c+65535,c=Math.floor(s/65536),p=s-c*65536,s=D+c+65535,c=Math.floor(s/65536),D=s-c*65536,s=m+c+65535,c=Math.floor(s/65536),m=s-c*65536,s=l+c+65535,c=Math.floor(s/65536),l=s-c*65536,s=T+c+65535,c=Math.floor(s/65536),T=s-c*65536,s=R+c+65535,c=Math.floor(s/65536),R=s-c*65536,s=z+c+65535,c=Math.floor(s/65536),z=s-c*65536,s=I+c+65535,c=Math.floor(s/65536),I=s-c*65536,s=M+c+65535,c=Math.floor(s/65536),M=s-c*65536,s=K+c+65535,c=Math.floor(s/65536),K=s-c*65536,s=G+c+65535,c=Math.floor(s/65536),G=s-c*65536,s=V+c+65535,c=Math.floor(s/65536),V=s-c*65536,s=Z+c+65535,c=Math.floor(s/65536),Z=s-c*65536,H+=c-1+37*(c-1),c=1,s=H+c+65535,c=Math.floor(s/65536),H=s-c*65536,s=o+c+65535,c=Math.floor(s/65536),o=s-c*65536,s=d+c+65535,c=Math.floor(s/65536),d=s-c*65536,s=p+c+65535,c=Math.floor(s/65536),p=s-c*65536,s=D+c+65535,c=Math.floor(s/65536),D=s-c*65536,s=m+c+65535,c=Math.floor(s/65536),m=s-c*65536,s=l+c+65535,c=Math.floor(s/65536),l=s-c*65536,s=T+c+65535,c=Math.floor(s/65536),T=s-c*65536,s=R+c+65535,c=Math.floor(s/65536),R=s-c*65536,s=z+c+65535,c=Math.floor(s/65536),z=s-c*65536,s=I+c+65535,c=Math.floor(s/65536),I=s-c*65536,s=M+c+65535,c=Math.floor(s/65536),M=s-c*65536,s=K+c+65535,c=Math.floor(s/65536),K=s-c*65536,s=G+c+65535,c=Math.floor(s/65536),G=s-c*65536,s=V+c+65535,c=Math.floor(s/65536),V=s-c*65536,s=Z+c+65535,c=Math.floor(s/65536),Z=s-c*65536,H+=c-1+37*(c-1),g[0]=H,g[1]=o,g[2]=d,g[3]=p,g[4]=D,g[5]=m,g[6]=l,g[7]=T,g[8]=R,g[9]=z,g[10]=I,g[11]=M,g[12]=K,g[13]=G,g[14]=V,g[15]=Z}function N(g,y){$(g,y,y)}function A(g,y){const w=i();for(let s=0;s<16;s++)w[s]=y[s];for(let s=253;s>=0;s--)N(w,w),s!==2&&s!==4&&$(w,w,y);for(let s=0;s<16;s++)g[s]=w[s]}function q(g,y){const w=new Uint8Array(32),s=new Float64Array(80),c=i(),H=i(),o=i(),d=i(),p=i(),D=i();for(let R=0;R<31;R++)w[R]=g[R];w[31]=g[31]&127|64,w[0]&=248,O(s,y);for(let R=0;R<16;R++)H[R]=s[R];c[0]=d[0]=1;for(let R=254;R>=0;--R){const z=w[R>>>3]>>>(R&7)&1;f(c,H,z),f(o,d,z),v(p,c,o),x(c,c,o),v(o,H,d),x(H,H,d),N(d,p),N(D,c),$(c,o,c),$(o,H,p),v(p,c,o),x(c,c,o),N(H,c),x(o,d,D),$(c,o,h),v(c,c,d),$(o,o,c),$(c,d,D),$(d,H,s),N(H,p),f(c,H,z),f(o,d,z)}for(let R=0;R<16;R++)s[R+16]=c[R],s[R+32]=o[R],s[R+48]=H[R],s[R+64]=d[R];const m=s.subarray(32),l=s.subarray(16);A(m,m),$(l,l,m);const T=new Uint8Array(32);return _(T,l),T}t.scalarMult=q;function F(g){return q(g,n)}t.scalarMultBase=F;function B(g){if(g.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const y=new Uint8Array(g);return{publicKey:F(y),secretKey:y}}t.generateKeyPairFromSeed=B;function u(g){const y=(0,e.randomBytes)(32,g),w=B(y);return(0,r.wipe)(y),w}t.generateKeyPair=u;function b(g,y,w=!1){if(g.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(y.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const s=q(g,y);if(w){let c=0;for(let H=0;H<s.length;H++)c|=s[H];if(c===0)throw new Error("X25519: invalid shared key")}return s}t.sharedKey=b})(sn);function Da(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function ss(t,e){e||(e=t.reduce((n,h)=>n+h.length,0));const r=Da(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return r}function Sa(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const as=Sa("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),mi=Sa("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Da(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Oa={utf8:as,"utf-8":as,hex:Vr.base16,latin1:mi,ascii:mi,binary:mi,...Vr};function yt(t,e="utf8"){const r=Oa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function _t(t,e="utf8"){const r=Oa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var an={};Object.defineProperty(an,"__esModule",{value:!0});an.getWindowMetadata=void 0;const os=Ki;function zh(){let t,e;try{t=os.getDocumentOrThrow(),e=os.getLocationOrThrow()}catch{return null}function r(){const x=t.getElementsByTagName("link"),$=[];for(let N=0;N<x.length;N++){const A=x[N],q=A.getAttribute("rel");if(q&&q.toLowerCase().indexOf("icon")>-1){const F=A.getAttribute("href");if(F)if(F.toLowerCase().indexOf("https:")===-1&&F.toLowerCase().indexOf("http:")===-1&&F.indexOf("//")!==0){let B=e.protocol+"//"+e.host;if(F.indexOf("/")===0)B+=F;else{const u=e.pathname.split("/");u.pop();const b=u.join("/");B+=b+"/"+F}$.push(B)}else if(F.indexOf("//")===0){const B=e.protocol+F;$.push(B)}else $.push(F)}}return $}function i(...x){const $=t.getElementsByTagName("meta");for(let N=0;N<$.length;N++){const A=$[N],q=["itemprop","property","name"].map(F=>A.getAttribute(F)).filter(F=>F?x.includes(F):!1);if(q.length&&q){const F=A.getAttribute("content");if(F)return F}}return""}function n(){let x=i("name","og:site_name","og:title","twitter:title");return x||(x=t.title),x}function h(){return i("description","og:description","twitter:description","keywords")}const E=n(),f=h(),_=e.origin,O=r();return{description:f,url:_,icons:O,name:E}}an.getWindowMetadata=zh;var mr={},on=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),h=0;h<i.length;h++){var E=i[h],f=t[E];(n?e.indexOf(E)!==-1:e(E,f,t))&&(r[E]=f)}return r};(function(t){const e=Gi,r=ki,i=Vi,n=on,h=u=>u==null,E=Symbol("encodeFragmentIdentifier");function f(u){switch(u.arrayFormat){case"index":return b=>(g,y)=>{const w=g.length;return y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),"[",w,"]"].join("")]:[...g,[v(b,u),"[",v(w,u),"]=",v(y,u)].join("")]};case"bracket":return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),"[]"].join("")]:[...g,[v(b,u),"[]=",v(y,u)].join("")];case"colon-list-separator":return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),":list="].join("")]:[...g,[v(b,u),":list=",v(y,u)].join("")];case"comma":case"separator":case"bracket-separator":{const b=u.arrayFormat==="bracket-separator"?"[]=":"=";return g=>(y,w)=>w===void 0||u.skipNull&&w===null||u.skipEmptyString&&w===""?y:(w=w===null?"":w,y.length===0?[[v(g,u),b,v(w,u)].join("")]:[[y,v(w,u)].join(u.arrayFormatSeparator)])}default:return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,v(b,u)]:[...g,[v(b,u),"=",v(y,u)].join("")]}}function _(u){let b;switch(u.arrayFormat){case"index":return(g,y,w)=>{if(b=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),!b){w[g]=y;return}w[g]===void 0&&(w[g]={}),w[g][b[1]]=y};case"bracket":return(g,y,w)=>{if(b=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),!b){w[g]=y;return}if(w[g]===void 0){w[g]=[y];return}w[g]=[].concat(w[g],y)};case"colon-list-separator":return(g,y,w)=>{if(b=/(:list)$/.exec(g),g=g.replace(/:list$/,""),!b){w[g]=y;return}if(w[g]===void 0){w[g]=[y];return}w[g]=[].concat(w[g],y)};case"comma":case"separator":return(g,y,w)=>{const s=typeof y=="string"&&y.includes(u.arrayFormatSeparator),c=typeof y=="string"&&!s&&x(y,u).includes(u.arrayFormatSeparator);y=c?x(y,u):y;const H=s||c?y.split(u.arrayFormatSeparator).map(o=>x(o,u)):y===null?y:x(y,u);w[g]=H};case"bracket-separator":return(g,y,w)=>{const s=/(\[\])$/.test(g);if(g=g.replace(/\[\]$/,""),!s){w[g]=y&&x(y,u);return}const c=y===null?[]:y.split(u.arrayFormatSeparator).map(H=>x(H,u));if(w[g]===void 0){w[g]=c;return}w[g]=[].concat(w[g],c)};default:return(g,y,w)=>{if(w[g]===void 0){w[g]=y;return}w[g]=[].concat(w[g],y)}}}function O(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function v(u,b){return b.encode?b.strict?e(u):encodeURIComponent(u):u}function x(u,b){return b.decode?r(u):u}function $(u){return Array.isArray(u)?u.sort():typeof u=="object"?$(Object.keys(u)).sort((b,g)=>Number(b)-Number(g)).map(b=>u[b]):u}function N(u){const b=u.indexOf("#");return b!==-1&&(u=u.slice(0,b)),u}function A(u){let b="";const g=u.indexOf("#");return g!==-1&&(b=u.slice(g)),b}function q(u){u=N(u);const b=u.indexOf("?");return b===-1?"":u.slice(b+1)}function F(u,b){return b.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):b.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function B(u,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),O(b.arrayFormatSeparator);const g=_(b),y=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return y;for(const w of u.split("&")){if(w==="")continue;let[s,c]=i(b.decode?w.replace(/\+/g," "):w,"=");c=c===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?c:x(c,b),g(x(s,b),c,y)}for(const w of Object.keys(y)){const s=y[w];if(typeof s=="object"&&s!==null)for(const c of Object.keys(s))s[c]=F(s[c],b);else y[w]=F(s,b)}return b.sort===!1?y:(b.sort===!0?Object.keys(y).sort():Object.keys(y).sort(b.sort)).reduce((w,s)=>{const c=y[s];return Boolean(c)&&typeof c=="object"&&!Array.isArray(c)?w[s]=$(c):w[s]=c,w},Object.create(null))}t.extract=q,t.parse=B,t.stringify=(u,b)=>{if(!u)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),O(b.arrayFormatSeparator);const g=c=>b.skipNull&&h(u[c])||b.skipEmptyString&&u[c]==="",y=f(b),w={};for(const c of Object.keys(u))g(c)||(w[c]=u[c]);const s=Object.keys(w);return b.sort!==!1&&s.sort(b.sort),s.map(c=>{const H=u[c];return H===void 0?"":H===null?v(c,b):Array.isArray(H)?H.length===0&&b.arrayFormat==="bracket-separator"?v(c,b)+"[]":H.reduce(y(c),[]).join("&"):v(c,b)+"="+v(H,b)}).filter(c=>c.length>0).join("&")},t.parseUrl=(u,b)=>{b=Object.assign({decode:!0},b);const[g,y]=i(u,"#");return Object.assign({url:g.split("?")[0]||"",query:B(q(u),b)},b&&b.parseFragmentIdentifier&&y?{fragmentIdentifier:x(y,b)}:{})},t.stringifyUrl=(u,b)=>{b=Object.assign({encode:!0,strict:!0,[E]:!0},b);const g=N(u.url).split("?")[0]||"",y=t.extract(u.url),w=t.parse(y,{sort:!1}),s=Object.assign(w,u.query);let c=t.stringify(s,b);c&&(c=`?${c}`);let H=A(u.url);return u.fragmentIdentifier&&(H=`#${b[E]?v(u.fragmentIdentifier,b):u.fragmentIdentifier}`),`${g}${c}${H}`},t.pick=(u,b,g)=>{g=Object.assign({parseFragmentIdentifier:!0,[E]:!1},g);const{url:y,query:w,fragmentIdentifier:s}=t.parseUrl(u,g);return t.stringifyUrl({url:y,query:n(w,b),fragmentIdentifier:s},g)},t.exclude=(u,b,g)=>{const y=Array.isArray(b)?w=>!b.includes(w):(w,s)=>!b(w,s);return t.pick(u,y,g)}})(mr);const qh={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},Ia="base10",nt="base16",Fi="base64pad",cn="utf8",xa=0,ir=1,Bh=0,cs=1,ji=12,un=32;function Kh(){const t=sn.generateKeyPair();return{privateKey:_t(t.secretKey,nt),publicKey:_t(t.publicKey,nt)}}function Li(){const t=rr.randomBytes(un);return _t(t,nt)}function Vh(t,e){const r=sn.sharedKey(yt(t,nt),yt(e,nt)),i=new Hh(ni.SHA256,r).expand(un);return _t(i,nt)}function Gh(t){const e=ni.hash(yt(t,nt));return _t(e,nt)}function $i(t){const e=ni.hash(yt(t,cn));return _t(e,nt)}function kh(t){return yt(`${t}`,Ia)}function Ir(t){return Number(_t(t,Ia))}function Yh(t){const e=kh(typeof t.type<"u"?t.type:xa);if(Ir(e)===ir&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?yt(t.senderPublicKey,nt):void 0,i=typeof t.iv<"u"?yt(t.iv,nt):rr.randomBytes(ji),n=new rn.ChaCha20Poly1305(yt(t.symKey,nt)).seal(i,yt(t.message,cn));return Jh({type:e,sealed:n,iv:i,senderPublicKey:r})}function Wh(t){const e=new rn.ChaCha20Poly1305(yt(t.symKey,nt)),{sealed:r,iv:i}=hn(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return _t(n,cn)}function Jh(t){if(Ir(t.type)===ir){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return _t(ss([t.type,t.senderPublicKey,t.iv,t.sealed]),Fi)}return _t(ss([t.type,t.iv,t.sealed]),Fi)}function hn(t){const e=yt(t,Fi),r=e.slice(Bh,cs),i=cs;if(Ir(r)===ir){const f=i+un,_=f+ji,O=e.slice(i,f),v=e.slice(f,_),x=e.slice(_);return{type:r,sealed:x,iv:v,senderPublicKey:O}}const n=i+ji,h=e.slice(i,n),E=e.slice(n);return{type:r,sealed:E,iv:h}}function Xh(t,e){const r=hn(t);return Pa({type:Ir(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?_t(r.senderPublicKey,nt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Pa(t){const e=(t==null?void 0:t.type)||xa;if(e===ir){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function us(t){return t.type===ir&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Zh=Object.defineProperty,hs=Object.getOwnPropertySymbols,Qh=Object.prototype.hasOwnProperty,ef=Object.prototype.propertyIsEnumerable,fs=(t,e,r)=>e in t?Zh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ls=(t,e)=>{for(var r in e||(e={}))Qh.call(e,r)&&fs(t,r,e[r]);if(hs)for(var r of hs(e))ef.call(e,r)&&fs(t,r,e[r]);return t};const tf="ReactNative",pr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},rf="js";function Ta(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function nf(){return!Vo()&&!!ks()&&navigator.product===tf}function sf(){return!Ta()&&!!ks()}function af(){return nf()?pr.reactNative:Ta()?pr.node:sf()?pr.browser:pr.unknown}function of(t,e){let r=mr.parse(t);return r=ls(ls({},r),e),t=mr.stringify(r),t}function cf(){const t=Bo();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function uf(){var t;const e=af();return e===pr.browser?[e,((t=Ko())==null?void 0:t.host)||"unknown"].join(":"):e}function hf(t,e,r){const i=cf(),n=uf();return[[t,e].join("-"),[rf,r].join("-"),i,n].join("/")}function ff({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:h}){const E=r.split("?"),f=hf(t,e,i),_={auth:n,ua:f,projectId:h},O=of(E[1]||"",_);return E[0]+"?"+O}function Aa(t){return Object.fromEntries(t.entries())}function Na(t){return new Map(Object.entries(t))}function wi(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function ds(t){return Q.fromMiliseconds(Date.now())>=Q.toMiliseconds(t)}function lf(t){const e=Q.toMiliseconds(t||Q.FIVE_MINUTES);let r,i,n;return{resolve:h=>{n&&r&&(clearTimeout(n),r(h))},reject:h=>{n&&i&&(clearTimeout(n),i(h))},done:()=>new Promise((h,E)=>{n=setTimeout(E,e),r=h,i=E})}}function Ca(t,e){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(),e),h=await t;clearTimeout(n),r(h)})}function Ua(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function df(t){return Ua("topic",t)}function gf(t){return Ua("id",t)}function pf(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ei(t,e){return`${t}${e?`:${e}`:""}`}const yf="irn";function Mi(t){return(t==null?void 0:t.relay)||{protocol:yf}}function Hi(t){const e=qh[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var _f=Object.defineProperty,gs=Object.getOwnPropertySymbols,bf=Object.prototype.hasOwnProperty,mf=Object.prototype.propertyIsEnumerable,ps=(t,e,r)=>e in t?_f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wf=(t,e)=>{for(var r in e||(e={}))bf.call(e,r)&&ps(t,r,e[r]);if(gs)for(var r of gs(e))mf.call(e,r)&&ps(t,r,e[r]);return t};function Ef(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const h=n.replace(i,""),E=t[n];r[h]=E}}),r}function vf(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),h=typeof r<"u"?t.substring(r):"",E=mr.parse(h);return{protocol:i,topic:n[0],version:parseInt(n[1],10),symKey:E.symKey,relay:Ef(E)}}function Df(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const h=r+e+n;t[n]&&(i[h]=t[n])}),i}function Sf(t){return`${t.protocol}:${t.topic}@${t.version}?`+mr.stringify(wf({symKey:t.symKey},Df(t.relay)))}const Of={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},If={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Oe(t,e){const{message:r,code:i}=If[t];return{message:e?`${r} ${e}`:r,code:i}}function yr(t,e){const{message:r,code:i}=Of[t];return{message:e?`${r} ${e}`:r,code:i}}function kr(t){return typeof t>"u"}function Ra(t,e){return e&&kr(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function xf(t){if(Ra(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Pf(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Tf(t){return t==null?void 0:t.topic}function vi(t){return typeof t<"u"&&typeof t!==null}const ys=10,Af=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Nf=()=>typeof window<"u",Cf=Af();class Uf{constructor(e){if(this.url=e,this.events=new lt.EventEmitter,this.registering=!1,!An(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=()=>{this.onClose(),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Bi(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!An(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),n(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Go.isReactNative()?void 0:{rejectUnauthorized:!ko(e)},h=new Cf(e,[],n);Nf()?h.onerror=E=>{const f=E;i(this.emitError(f.error))}:h.on("error",E=>{i(this.emitError(E))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ys(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),h=Yi(e,n);this.events.emit("payload",h)}parseError(e,r=this.url){return Yo(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>ys&&this.events.setMaxListeners(ys)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var Yr={},Rf={get exports(){return Yr},set exports(t){Yr=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,h=2,E=9007199254740991,f="[object Arguments]",_="[object Array]",O="[object AsyncFunction]",v="[object Boolean]",x="[object Date]",$="[object Error]",N="[object Function]",A="[object GeneratorFunction]",q="[object Map]",F="[object Number]",B="[object Null]",u="[object Object]",b="[object Promise]",g="[object Proxy]",y="[object RegExp]",w="[object Set]",s="[object String]",c="[object Symbol]",H="[object Undefined]",o="[object WeakMap]",d="[object ArrayBuffer]",p="[object DataView]",D="[object Float32Array]",m="[object Float64Array]",l="[object Int8Array]",T="[object Int16Array]",R="[object Int32Array]",z="[object Uint8Array]",I="[object Uint8ClampedArray]",M="[object Uint16Array]",K="[object Uint32Array]",G=/[\\^$.*+?()[\]{}|]/g,V=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,W={};W[D]=W[m]=W[l]=W[T]=W[R]=W[z]=W[I]=W[M]=W[K]=!0,W[f]=W[_]=W[d]=W[v]=W[p]=W[x]=W[$]=W[N]=W[q]=W[F]=W[u]=W[y]=W[w]=W[s]=W[o]=!1;var oe=typeof rt=="object"&&rt&&rt.Object===Object&&rt,L=typeof self=="object"&&self&&self.Object===Object&&self,j=oe||L||Function("return this")(),C=e&&!e.nodeType&&e,a=C&&!0&&t&&!t.nodeType&&t,P=a&&a.exports===C,Y=P&&oe.process,J=function(){try{return Y&&Y.binding&&Y.binding("util")}catch{}}(),fe=J&&J.isTypedArray;function _e(S,U){for(var k=-1,X=S==null?0:S.length,Ie=0,ne=[];++k<X;){var Ce=S[k];U(Ce,k,S)&&(ne[Ie++]=Ce)}return ne}function de(S,U){for(var k=-1,X=U.length,Ie=S.length;++k<X;)S[Ie+k]=U[k];return S}function we(S,U){for(var k=-1,X=S==null?0:S.length;++k<X;)if(U(S[k],k,S))return!0;return!1}function Ue(S,U){for(var k=-1,X=Array(S);++k<S;)X[k]=U(k);return X}function Te(S){return function(U){return S(U)}}function ye(S,U){return S.has(U)}function ge(S,U){return S==null?void 0:S[U]}function le(S){var U=-1,k=Array(S.size);return S.forEach(function(X,Ie){k[++U]=[Ie,X]}),k}function ue(S,U){return function(k){return S(U(k))}}function ce(S){var U=-1,k=Array(S.size);return S.forEach(function(X){k[++U]=X}),k}var ae=Array.prototype,se=Function.prototype,te=Object.prototype,he=j["__core-js_shared__"],pe=se.toString,re=te.hasOwnProperty,be=function(){var S=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return S?"Symbol(src)_1."+S:""}(),me=te.toString,ve=RegExp("^"+pe.call(re).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=P?j.Buffer:void 0,Ee=j.Symbol,dt=j.Uint8Array,bt=te.propertyIsEnumerable,Pt=ae.splice,st=Ee?Ee.toStringTag:void 0,Lt=Object.getOwnPropertySymbols,nr=De?De.isBuffer:void 0,Tr=ue(Object.keys,Object),Re=kt(j,"DataView"),Ae=kt(j,"Map"),Fe=kt(j,"Promise"),je=kt(j,"Set"),Le=kt(j,"WeakMap"),Ne=kt(Object,"create"),He=Mt(Re),ze=Mt(Ae),qe=Mt(Fe),Be=Mt(je),Ke=Mt(Le),Me=Ee?Ee.prototype:void 0,$e=Me?Me.valueOf:void 0;function xe(S){var U=-1,k=S==null?0:S.length;for(this.clear();++U<k;){var X=S[U];this.set(X[0],X[1])}}function Ve(){this.__data__=Ne?Ne(null):{},this.size=0}function Ge(S){var U=this.has(S)&&delete this.__data__[S];return this.size-=U?1:0,U}function Qa(S){var U=this.__data__;if(Ne){var k=U[S];return k===i?void 0:k}return re.call(U,S)?U[S]:void 0}function eo(S){var U=this.__data__;return Ne?U[S]!==void 0:re.call(U,S)}function to(S,U){var k=this.__data__;return this.size+=this.has(S)?0:1,k[S]=Ne&&U===void 0?i:U,this}xe.prototype.clear=Ve,xe.prototype.delete=Ge,xe.prototype.get=Qa,xe.prototype.has=eo,xe.prototype.set=to;function Dt(S){var U=-1,k=S==null?0:S.length;for(this.clear();++U<k;){var X=S[U];this.set(X[0],X[1])}}function ro(){this.__data__=[],this.size=0}function io(S){var U=this.__data__,k=Nr(U,S);if(k<0)return!1;var X=U.length-1;return k==X?U.pop():Pt.call(U,k,1),--this.size,!0}function no(S){var U=this.__data__,k=Nr(U,S);return k<0?void 0:U[k][1]}function so(S){return Nr(this.__data__,S)>-1}function ao(S,U){var k=this.__data__,X=Nr(k,S);return X<0?(++this.size,k.push([S,U])):k[X][1]=U,this}Dt.prototype.clear=ro,Dt.prototype.delete=io,Dt.prototype.get=no,Dt.prototype.has=so,Dt.prototype.set=ao;function $t(S){var U=-1,k=S==null?0:S.length;for(this.clear();++U<k;){var X=S[U];this.set(X[0],X[1])}}function oo(){this.size=0,this.__data__={hash:new xe,map:new(Ae||Dt),string:new xe}}function co(S){var U=Cr(this,S).delete(S);return this.size-=U?1:0,U}function uo(S){return Cr(this,S).get(S)}function ho(S){return Cr(this,S).has(S)}function fo(S,U){var k=Cr(this,S),X=k.size;return k.set(S,U),this.size+=k.size==X?0:1,this}$t.prototype.clear=oo,$t.prototype.delete=co,$t.prototype.get=uo,$t.prototype.has=ho,$t.prototype.set=fo;function Ar(S){var U=-1,k=S==null?0:S.length;for(this.__data__=new $t;++U<k;)this.add(S[U])}function lo(S){return this.__data__.set(S,i),this}function go(S){return this.__data__.has(S)}Ar.prototype.add=Ar.prototype.push=lo,Ar.prototype.has=go;function Tt(S){var U=this.__data__=new Dt(S);this.size=U.size}function po(){this.__data__=new Dt,this.size=0}function yo(S){var U=this.__data__,k=U.delete(S);return this.size=U.size,k}function _o(S){return this.__data__.get(S)}function bo(S){return this.__data__.has(S)}function mo(S,U){var k=this.__data__;if(k instanceof Dt){var X=k.__data__;if(!Ae||X.length<r-1)return X.push([S,U]),this.size=++k.size,this;k=this.__data__=new $t(X)}return k.set(S,U),this.size=k.size,this}Tt.prototype.clear=po,Tt.prototype.delete=yo,Tt.prototype.get=_o,Tt.prototype.has=bo,Tt.prototype.set=mo;function wo(S,U){var k=Ur(S),X=!k&&Fo(S),Ie=!k&&!X&&ci(S),ne=!k&&!X&&!Ie&&Pn(S),Ce=k||X||Ie||ne,ke=Ce?Ue(S.length,String):[],We=ke.length;for(var Pe in S)(U||re.call(S,Pe))&&!(Ce&&(Pe=="length"||Ie&&(Pe=="offset"||Pe=="parent")||ne&&(Pe=="buffer"||Pe=="byteLength"||Pe=="byteOffset")||Ao(Pe,We)))&&ke.push(Pe);return ke}function Nr(S,U){for(var k=S.length;k--;)if(Sn(S[k][0],U))return k;return-1}function Eo(S,U,k){var X=U(S);return Ur(S)?X:de(X,k(S))}function sr(S){return S==null?S===void 0?H:B:st&&st in Object(S)?Po(S):Ro(S)}function wn(S){return ar(S)&&sr(S)==f}function En(S,U,k,X,Ie){return S===U?!0:S==null||U==null||!ar(S)&&!ar(U)?S!==S&&U!==U:vo(S,U,k,X,En,Ie)}function vo(S,U,k,X,Ie,ne){var Ce=Ur(S),ke=Ur(U),We=Ce?_:At(S),Pe=ke?_:At(U);We=We==f?u:We,Pe=Pe==f?u:Pe;var at=We==u,gt=Pe==u,Ze=We==Pe;if(Ze&&ci(S)){if(!ci(U))return!1;Ce=!0,at=!1}if(Ze&&!at)return ne||(ne=new Tt),Ce||Pn(S)?vn(S,U,k,X,Ie,ne):Io(S,U,We,k,X,Ie,ne);if(!(k&n)){var ut=at&&re.call(S,"__wrapped__"),ht=gt&&re.call(U,"__wrapped__");if(ut||ht){var Nt=ut?S.value():S,St=ht?U.value():U;return ne||(ne=new Tt),Ie(Nt,St,k,X,ne)}}return Ze?(ne||(ne=new Tt),xo(S,U,k,X,Ie,ne)):!1}function Do(S){if(!xn(S)||Co(S))return!1;var U=On(S)?ve:V;return U.test(Mt(S))}function So(S){return ar(S)&&In(S.length)&&!!W[sr(S)]}function Oo(S){if(!Uo(S))return Tr(S);var U=[];for(var k in Object(S))re.call(S,k)&&k!="constructor"&&U.push(k);return U}function vn(S,U,k,X,Ie,ne){var Ce=k&n,ke=S.length,We=U.length;if(ke!=We&&!(Ce&&We>ke))return!1;var Pe=ne.get(S);if(Pe&&ne.get(U))return Pe==U;var at=-1,gt=!0,Ze=k&h?new Ar:void 0;for(ne.set(S,U),ne.set(U,S);++at<ke;){var ut=S[at],ht=U[at];if(X)var Nt=Ce?X(ht,ut,at,U,S,ne):X(ut,ht,at,S,U,ne);if(Nt!==void 0){if(Nt)continue;gt=!1;break}if(Ze){if(!we(U,function(St,Ht){if(!ye(Ze,Ht)&&(ut===St||Ie(ut,St,k,X,ne)))return Ze.push(Ht)})){gt=!1;break}}else if(!(ut===ht||Ie(ut,ht,k,X,ne))){gt=!1;break}}return ne.delete(S),ne.delete(U),gt}function Io(S,U,k,X,Ie,ne,Ce){switch(k){case p:if(S.byteLength!=U.byteLength||S.byteOffset!=U.byteOffset)return!1;S=S.buffer,U=U.buffer;case d:return!(S.byteLength!=U.byteLength||!ne(new dt(S),new dt(U)));case v:case x:case F:return Sn(+S,+U);case $:return S.name==U.name&&S.message==U.message;case y:case s:return S==U+"";case q:var ke=le;case w:var We=X&n;if(ke||(ke=ce),S.size!=U.size&&!We)return!1;var Pe=Ce.get(S);if(Pe)return Pe==U;X|=h,Ce.set(S,U);var at=vn(ke(S),ke(U),X,Ie,ne,Ce);return Ce.delete(S),at;case c:if($e)return $e.call(S)==$e.call(U)}return!1}function xo(S,U,k,X,Ie,ne){var Ce=k&n,ke=Dn(S),We=ke.length,Pe=Dn(U),at=Pe.length;if(We!=at&&!Ce)return!1;for(var gt=We;gt--;){var Ze=ke[gt];if(!(Ce?Ze in U:re.call(U,Ze)))return!1}var ut=ne.get(S);if(ut&&ne.get(U))return ut==U;var ht=!0;ne.set(S,U),ne.set(U,S);for(var Nt=Ce;++gt<We;){Ze=ke[gt];var St=S[Ze],Ht=U[Ze];if(X)var Tn=Ce?X(Ht,St,Ze,U,S,ne):X(St,Ht,Ze,S,U,ne);if(!(Tn===void 0?St===Ht||Ie(St,Ht,k,X,ne):Tn)){ht=!1;break}Nt||(Nt=Ze=="constructor")}if(ht&&!Nt){var Rr=S.constructor,Fr=U.constructor;Rr!=Fr&&"constructor"in S&&"constructor"in U&&!(typeof Rr=="function"&&Rr instanceof Rr&&typeof Fr=="function"&&Fr instanceof Fr)&&(ht=!1)}return ne.delete(S),ne.delete(U),ht}function Dn(S){return Eo(S,$o,To)}function Cr(S,U){var k=S.__data__;return No(U)?k[typeof U=="string"?"string":"hash"]:k.map}function kt(S,U){var k=ge(S,U);return Do(k)?k:void 0}function Po(S){var U=re.call(S,st),k=S[st];try{S[st]=void 0;var X=!0}catch{}var Ie=me.call(S);return X&&(U?S[st]=k:delete S[st]),Ie}var To=Lt?function(S){return S==null?[]:(S=Object(S),_e(Lt(S),function(U){return bt.call(S,U)}))}:Mo,At=sr;(Re&&At(new Re(new ArrayBuffer(1)))!=p||Ae&&At(new Ae)!=q||Fe&&At(Fe.resolve())!=b||je&&At(new je)!=w||Le&&At(new Le)!=o)&&(At=function(S){var U=sr(S),k=U==u?S.constructor:void 0,X=k?Mt(k):"";if(X)switch(X){case He:return p;case ze:return q;case qe:return b;case Be:return w;case Ke:return o}return U});function Ao(S,U){return U=U??E,!!U&&(typeof S=="number"||Z.test(S))&&S>-1&&S%1==0&&S<U}function No(S){var U=typeof S;return U=="string"||U=="number"||U=="symbol"||U=="boolean"?S!=="__proto__":S===null}function Co(S){return!!be&&be in S}function Uo(S){var U=S&&S.constructor,k=typeof U=="function"&&U.prototype||te;return S===k}function Ro(S){return me.call(S)}function Mt(S){if(S!=null){try{return pe.call(S)}catch{}try{return S+""}catch{}}return""}function Sn(S,U){return S===U||S!==S&&U!==U}var Fo=wn(function(){return arguments}())?wn:function(S){return ar(S)&&re.call(S,"callee")&&!bt.call(S,"callee")},Ur=Array.isArray;function jo(S){return S!=null&&In(S.length)&&!On(S)}var ci=nr||Ho;function Lo(S,U){return En(S,U)}function On(S){if(!xn(S))return!1;var U=sr(S);return U==N||U==A||U==O||U==g}function In(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=E}function xn(S){var U=typeof S;return S!=null&&(U=="object"||U=="function")}function ar(S){return S!=null&&typeof S=="object"}var Pn=fe?Te(fe):So;function $o(S){return jo(S)?wo(S):Oo(S)}function Mo(){return[]}function Ho(){return!1}t.exports=Lo})(Rf,Yr);function Ff(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var h=t.charAt(n),E=h.charCodeAt(0);if(r[E]!==255)throw new TypeError(h+" is ambiguous");r[E]=n}var f=t.length,_=t.charAt(0),O=Math.log(f)/Math.log(256),v=Math.log(256)/Math.log(f);function x(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var q=0,F=0,B=0,u=A.length;B!==u&&A[B]===0;)B++,q++;for(var b=(u-B)*v+1>>>0,g=new Uint8Array(b);B!==u;){for(var y=A[B],w=0,s=b-1;(y!==0||w<F)&&s!==-1;s--,w++)y+=256*g[s]>>>0,g[s]=y%f>>>0,y=y/f>>>0;if(y!==0)throw new Error("Non-zero carry");F=w,B++}for(var c=b-F;c!==b&&g[c]===0;)c++;for(var H=_.repeat(q);c<b;++c)H+=t.charAt(g[c]);return H}function $(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var q=0;if(A[q]!==" "){for(var F=0,B=0;A[q]===_;)F++,q++;for(var u=(A.length-q)*O+1>>>0,b=new Uint8Array(u);A[q];){var g=r[A.charCodeAt(q)];if(g===255)return;for(var y=0,w=u-1;(g!==0||y<B)&&w!==-1;w--,y++)g+=f*b[w]>>>0,b[w]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");B=y,q++}if(A[q]!==" "){for(var s=u-B;s!==u&&b[s]===0;)s++;for(var c=new Uint8Array(F+(u-s)),H=F;s!==u;)c[H++]=b[s++];return c}}}function N(A){var q=$(A);if(q)return q;throw new Error(`Non-${e} character`)}return{encode:x,decodeUnsafe:$,decode:N}}var jf=Ff,Lf=jf;const Fa=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},$f=t=>new TextEncoder().encode(t),Mf=t=>new TextDecoder().decode(t);class Hf{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class zf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ja(this,e)}}class qf{constructor(e){this.decoders=e}or(e){return ja(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ja=(t,e)=>new qf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Bf{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Hf(e,r,i),this.decoder=new zf(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const si=({name:t,prefix:e,encode:r,decode:i})=>new Bf(t,e,r,i),xr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Lf(r,e);return si({prefix:t,name:e,encode:i,decode:h=>Fa(n(h))})},Kf=(t,e,r,i)=>{const n={};for(let v=0;v<e.length;++v)n[e[v]]=v;let h=t.length;for(;t[h-1]==="=";)--h;const E=new Uint8Array(h*r/8|0);let f=0,_=0,O=0;for(let v=0;v<h;++v){const x=n[t[v]];if(x===void 0)throw new SyntaxError(`Non-${i} character`);_=_<<r|x,f+=r,f>=8&&(f-=8,E[O++]=255&_>>f)}if(f>=r||255&_<<8-f)throw new SyntaxError("Unexpected end of data");return E},Vf=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let h="",E=0,f=0;for(let _=0;_<t.length;++_)for(f=f<<8|t[_],E+=8;E>r;)E-=r,h+=e[n&f>>E];if(E&&(h+=e[n&f<<r-E]),i)for(;h.length*r&7;)h+="=";return h},Xe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>si({prefix:e,name:t,encode(n){return Vf(n,i,r)},decode(n){return Kf(n,i,r,t)}}),Gf=si({prefix:"\0",name:"identity",encode:t=>Mf(t),decode:t=>$f(t)});var kf=Object.freeze({__proto__:null,identity:Gf});const Yf=Xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Wf=Object.freeze({__proto__:null,base2:Yf});const Jf=Xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Xf=Object.freeze({__proto__:null,base8:Jf});const Zf=xr({prefix:"9",name:"base10",alphabet:"0123456789"});var Qf=Object.freeze({__proto__:null,base10:Zf});const el=Xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tl=Xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rl=Object.freeze({__proto__:null,base16:el,base16upper:tl});const il=Xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nl=Xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sl=Xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),al=Xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ol=Xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cl=Xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ul=Xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hl=Xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fl=Xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ll=Object.freeze({__proto__:null,base32:il,base32upper:nl,base32pad:sl,base32padupper:al,base32hex:ol,base32hexupper:cl,base32hexpad:ul,base32hexpadupper:hl,base32z:fl});const dl=xr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gl=xr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pl=Object.freeze({__proto__:null,base36:dl,base36upper:gl});const yl=xr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_l=xr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var bl=Object.freeze({__proto__:null,base58btc:yl,base58flickr:_l});const ml=Xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wl=Xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),El=Xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vl=Xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Dl=Object.freeze({__proto__:null,base64:ml,base64pad:wl,base64url:El,base64urlpad:vl});const La=Array.from(""),Sl=La.reduce((t,e,r)=>(t[r]=e,t),[]),Ol=La.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Il(t){return t.reduce((e,r)=>(e+=Sl[r],e),"")}function xl(t){const e=[];for(const r of t){const i=Ol[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Pl=si({prefix:"",name:"base256emoji",encode:Il,decode:xl});var Tl=Object.freeze({__proto__:null,base256emoji:Pl}),Al=$a,_s=128,Nl=127,Cl=~Nl,Ul=Math.pow(2,31);function $a(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Ul;)e[r++]=t&255|_s,t/=128;for(;t&Cl;)e[r++]=t&255|_s,t>>>=7;return e[r]=t|0,$a.bytes=r-i+1,e}var Rl=zi,Fl=128,bs=127;function zi(t,i){var r=0,i=i||0,n=0,h=i,E,f=t.length;do{if(h>=f)throw zi.bytes=0,new RangeError("Could not decode varint");E=t[h++],r+=n<28?(E&bs)<<n:(E&bs)*Math.pow(2,n),n+=7}while(E>=Fl);return zi.bytes=h-i,r}var jl=Math.pow(2,7),Ll=Math.pow(2,14),$l=Math.pow(2,21),Ml=Math.pow(2,28),Hl=Math.pow(2,35),zl=Math.pow(2,42),ql=Math.pow(2,49),Bl=Math.pow(2,56),Kl=Math.pow(2,63),Vl=function(t){return t<jl?1:t<Ll?2:t<$l?3:t<Ml?4:t<Hl?5:t<zl?6:t<ql?7:t<Bl?8:t<Kl?9:10},Gl={encode:Al,decode:Rl,encodingLength:Vl},Ma=Gl;const ms=(t,e,r=0)=>(Ma.encode(t,e,r),e),ws=t=>Ma.encodingLength(t),qi=(t,e)=>{const r=e.byteLength,i=ws(t),n=i+ws(r),h=new Uint8Array(n+r);return ms(t,h,0),ms(r,h,i),h.set(e,n),new kl(t,r,e,h)};class kl{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Ha=({name:t,code:e,encode:r})=>new Yl(t,e,r);class Yl{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?qi(this.code,r):r.then(i=>qi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const za=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Wl=Ha({name:"sha2-256",code:18,encode:za("SHA-256")}),Jl=Ha({name:"sha2-512",code:19,encode:za("SHA-512")});var Xl=Object.freeze({__proto__:null,sha256:Wl,sha512:Jl});const qa=0,Zl="identity",Ba=Fa,Ql=t=>qi(qa,Ba(t)),ed={code:qa,name:Zl,encode:Ba,digest:Ql};var td=Object.freeze({__proto__:null,identity:ed});new TextEncoder,new TextDecoder;const Es={...kf,...Wf,...Xf,...Qf,...rl,...ll,...pl,...bl,...Dl,...Tl};({...Xl,...td});function rd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Ka(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const vs=Ka("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Di=Ka("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=rd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),id={utf8:vs,"utf-8":vs,hex:Es.base16,latin1:Di,ascii:Di,binary:Di,...Es};function nd(t,e="utf8"){const r=id[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const Va="wc",sd=2,fn="core",Rt=`${Va}@${2}:${fn}:`,ad={name:fn,logger:"error"},od={database:":memory:"},cd="crypto",Ds="client_ed25519_seed",ud=Q.ONE_DAY,hd="keychain",fd="0.3",ld="messages",dd="0.3",gd=Q.SIX_HOURS,pd="publisher",Ga="irn",yd="error",_d="wss://relay.walletconnect.com",bd="relayer",et={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},md="_subscription",Lr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Ss=Q.ONE_SECOND,wd="2.3.3",Ed="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},vd="subscription",Dd="0.3",Sd=Q.FIVE_SECONDS*1e3,Od="pairing",Id="0.3",dr={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},xd="history",Pd="0.3",Td="expirer",ft={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ad="0.3";let Nd=class{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=hd,this.version=fd,this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:h}=Oe("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(h)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Aa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Na(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}};class Cd{constructor(e,r,i){this.core=e,this.logger=r,this.name=cd,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),h=rs(n);return _a(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Kh();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const h=await this.getClientSeed(),E=rs(h),f=Li();return await xh(f,n,ud,E)},this.generateSharedKey=(n,h,E)=>{this.isInitialized();const f=this.getPrivateKey(n),_=Vh(f,h);return this.setSymKey(_,E)},this.setSymKey=async(n,h)=>{this.isInitialized();const E=h||Gh(n);return await this.keychain.set(E,n),E},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,h,E)=>{this.isInitialized();const f=Pa(E),_=Bi(h);if(us(f)){const $=f.senderPublicKey,N=f.receiverPublicKey;n=await this.generateSharedKey($,N)}const O=this.getSymKey(n),{type:v,senderPublicKey:x}=f;return Yh({type:v,symKey:O,message:_,senderPublicKey:x})},this.decode=async(n,h,E)=>{this.isInitialized();const f=Xh(h,E);if(us(f)){const v=f.receiverPublicKey,x=f.senderPublicKey;n=await this.generateSharedKey(v,x)}const _=this.getSymKey(n),O=Wh({symKey:_,encoded:h});return Ys(O)},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new Nd(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const r=hn(e);return Ir(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ds)}catch{e=Li(),await this.keychain.set(Ds,e)}return nd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}let Ud=class extends Lc{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=ld,this.version=dd,this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const h=$i(n);let E=this.messages.get(i);return typeof E>"u"&&(E={}),typeof E[h]<"u"||(E[h]=n,this.messages.set(i,E),await this.persist()),h},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const h=this.get(i),E=$i(n);return typeof h[E]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Aa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Na(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}};class Rd extends $c{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new lt.EventEmitter,this.name=pd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,n,h)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:h}});try{const E=(h==null?void 0:h.ttl)||gd,f=Mi(h),_=(h==null?void 0:h.prompt)||!1,O=(h==null?void 0:h.tag)||0,v={topic:i,message:n,opts:{ttl:E,relay:f,prompt:_,tag:O}},x=$i(n);this.queue.set(x,v);try{await await Ca(this.rpcPublish(i,n,E,f,_,O),this.publishTimeout),this.relayer.events.emit(et.publish,v)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(et.connection_stalled);return}this.onPublish(x,v),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:h}})}catch(E){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(E),E}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,h,E){var f,_,O,v;const x={method:Hi(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:h,tag:E}};return kr((f=x.params)==null?void 0:f.prompt)&&((_=x.params)==null||delete _.prompt),kr((O=x.params)==null?void 0:O.tag)&&((v=x.params)==null||delete v.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:x}),this.relayer.provider.request(x)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Fd{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(h=>h!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var jd=Object.defineProperty,Ld=Object.defineProperties,$d=Object.getOwnPropertyDescriptors,Os=Object.getOwnPropertySymbols,Md=Object.prototype.hasOwnProperty,Hd=Object.prototype.propertyIsEnumerable,Is=(t,e,r)=>e in t?jd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$r=(t,e)=>{for(var r in e||(e={}))Md.call(e,r)&&Is(t,r,e[r]);if(Os)for(var r of Os(e))Hd.call(e,r)&&Is(t,r,e[r]);return t},Si=(t,e)=>Ld(t,$d(e));class zd extends zc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Fd,this.events=new lt.EventEmitter,this.name=vd,this.version=Dd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Rt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const h=Mi(n),E={topic:i,relay:h};this.pending.set(i,E);const f=await this.rpcSubscribe(i,h);return this.onSubscribe(f,E),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),f}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(i,n)=>{this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,h)=>{const E=new Q.Watch;E.start(this.pendingSubscriptionWatchLabel);const f=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(f),E.stop(this.pendingSubscriptionWatchLabel),n(!0)),E.elapsed(this.pendingSubscriptionWatchLabel)>=Sd&&(clearInterval(f),E.stop(this.pendingSubscriptionWatchLabel),h(!1))},this.pendingSubInterval)}),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Mi(i);await this.rpcUnsubscribe(e,r,n);const h=yr("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:Hi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Ca(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(et.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:Hi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}onSubscribe(e,r){this.setSubscription(e,Si($r({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,Si($r({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,$r({},r)),this.topicMap.set(r.topic,e),this.events.emit(Et.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Et.deleted,Si($r({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,n={topic:r,relay:i};this.pending.set(n.topic,n);const h=await this.rpcSubscribe(n.topic,n.relay);this.onResubscribe(h,n)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(et.connect,async()=>{await this.onConnect()}),this.relayer.on(et.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var qd=Object.defineProperty,xs=Object.getOwnPropertySymbols,Bd=Object.prototype.hasOwnProperty,Kd=Object.prototype.propertyIsEnumerable,Ps=(t,e,r)=>e in t?qd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vd=(t,e)=>{for(var r in e||(e={}))Bd.call(e,r)&&Ps(t,r,e[r]);if(xs)for(var r of xs(e))Kd.call(e,r)&&Ps(t,r,e[r]);return t};let Gd=class extends Mc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new lt.EventEmitter,this.name=bd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Er(Se.getDefaultLoggerOptions({level:e.logger||yd})),this.messages=new Ud(this.logger,e.core),this.subscriber=new zd(this,this.logger),this.publisher=new Rd(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||_d,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(n=>{this.subscriber.once(Et.created,h=>{h.topic===e&&n()})}),new Promise(async n=>{i=await this.subscriber.subscribe(e,r),n()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(et.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Et.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(et.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(et.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,Ss)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new wr(new Uf(ff({sdkVersion:wd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Wi(e)){if(!e.method.endsWith(md))return;const r=e.params,{topic:i,message:n}=r.data,h={topic:i,message:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Vd({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(e),await this.onMessageEvent(h)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(et.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Ji(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(Lr.payload,e=>this.onProviderPayload(e)),this.provider.on(Lr.connect,()=>{this.events.emit(et.connect)}),this.provider.on(Lr.disconnect,()=>{this.events.emit(et.disconnect),this.attemptToReconnect()}),this.provider.on(Lr.error,e=>this.events.emit(et.error,e)),this.events.on(et.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Q.toMiliseconds(Ss))}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}};var kd=Object.defineProperty,Ts=Object.getOwnPropertySymbols,Yd=Object.prototype.hasOwnProperty,Wd=Object.prototype.propertyIsEnumerable,As=(t,e,r)=>e in t?kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ns=(t,e)=>{for(var r in e||(e={}))Yd.call(e,r)&&As(t,r,e[r]);if(Ts)for(var r of Ts(e))Wd.call(e,r)&&As(t,r,e[r]);return t};class ai extends Hc{constructor(e,r,i,n=Rt,h=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Ed,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(E=>{Pf(E)?this.map.set(E.id,E):Tf(E)?this.map.set(E.topic,E):this.getKey&&E!==null&&!kr(E)&&this.map.set(this.getKey(E),E)}),this.cached=[],this.initialized=!0)},this.set=async(E,f)=>{this.isInitialized(),this.map.has(E)?await this.update(E,f):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:E,value:f}),this.map.set(E,f),await this.persist())},this.get=E=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:E}),this.getData(E)),this.getAll=E=>(this.isInitialized(),E?this.values.filter(f=>Object.keys(E).every(_=>Yr(f[_],E[_]))):this.values),this.update=async(E,f)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:E,update:f});const _=Ns(Ns({},this.getData(E)),f);this.map.set(E,_),await this.persist()},this.delete=async(E,f)=>{this.isInitialized(),this.map.has(E)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:E,reason:f}),this.map.delete(E),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=h}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Jd{constructor(e,r){this.core=e,this.logger=r,this.name=Od,this.version=Id,this.events=new lt,this.initialized=!1,this.storagePrefix=Rt,this.ignoredPayloadTypes=[ir],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Li(),n=await this.core.crypto.setSymKey(i),h=wi(Q.FIVE_MINUTES),E={protocol:Ga},f={topic:n,expiry:h,relay:E,active:!1},_=Sf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:E});return await this.pairings.set(n,f),await this.core.relayer.subscribe(n),this.core.expirer.set(n,h),{topic:n,uri:_}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:h,relay:E}=vf(i.uri),f=wi(Q.FIVE_MINUTES),_={topic:n,relay:E,expiry:f,active:!1};return await this.pairings.set(n,_),await this.core.crypto.setSymKey(h,n),await this.core.relayer.subscribe(n,{relay:E}),this.core.expirer.set(n,f),i.activatePairing&&await this.activate({topic:n}),_},this.activate=async({topic:i})=>{this.isInitialized();const n=wi(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const h=await this.sendRequest(n,"wc_pairingPing",{}),{done:E,resolve:f,reject:_}=lf();this.events.once(Ei("pairing_ping",h),({error:O})=>{O?_(O):f()}),await E()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",yr("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,h)=>{const E=Xi(n,h),f=await this.core.crypto.encode(i,E),_=dr[n].req;return this.core.history.set(i,E),await this.core.relayer.publish(i,f,_),E.id},this.sendResult=async(i,n,h)=>{const E=Ji(i,h),f=await this.core.crypto.encode(n,E),_=await this.core.history.get(n,i),O=dr[_.request.method].res;await this.core.relayer.publish(n,f,O),await this.core.history.resolve(E)},this.sendError=async(i,n,h)=>{const E=Yi(i,h),f=await this.core.crypto.encode(n,E),_=await this.core.history.get(n,i),O=dr[_.request.method]?dr[_.request.method].res:dr.unregistered_method.res;await this.core.relayer.publish(n,f,O),await this.core.history.resolve(E)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,yr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>ds(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:h}=i,E=h.method;if(this.pairings.keys.includes(n))switch(E){case"wc_pairingPing":return this.onPairingPingRequest(n,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,h);default:return this.onUnknownRpcMethodRequest(n,h)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:h}=i,E=(await this.core.history.get(n,h.id)).request.method;if(this.pairings.keys.includes(n))switch(E){case"wc_pairingPing":return this.onPairingPingResponse(n,h);default:return this.onUnknownRpcMethodResponse(E)}},this.onPairingPingRequest=async(i,n)=>{const{id:h}=n;try{this.isValidPing({topic:i}),await this.sendResult(h,i,!0),this.events.emit("pairing_ping",{id:h,topic:i})}catch(E){await this.sendError(h,i,E),this.logger.error(E)}},this.onPairingPingResponse=(i,n)=>{const{id:h}=n;setTimeout(()=>{Ct(n)?this.events.emit(Ei("pairing_ping",h),{}):It(n)&&this.events.emit(Ei("pairing_ping",h),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:h}=n;try{this.isValidDisconnect({topic:i}),await this.sendResult(h,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:h,topic:i})}catch(E){await this.sendError(h,i,E),this.logger.error(E)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:h,method:E}=n;try{if(this.registeredMethods.includes(E))return;const f=yr("WC_METHOD_UNSUPPORTED",E);await this.sendError(h,i,f),this.logger.error(f)}catch(f){await this.sendError(h,i,f),this.logger.error(f)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(yr("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!vi(i)){const{message:n}=Oe("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!xf(i.uri)){const{message:n}=Oe("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!vi(i)){const{message:h}=Oe("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(h)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!vi(i)){const{message:h}=Oe("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(h)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ra(i,!1)){const{message:n}=Oe("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=Oe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(ds(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=Oe("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new ai(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(et.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);Wi(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ws(n)&&(await this.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.core.expirer.on(ft.expired,async e=>{const{topic:r}=pf(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class Xd extends jc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new lt.EventEmitter,this.name=xd,this.version=Pd,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:h}),this.records.has(n.id))return;const E={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:h};this.records.set(E.id,E),this.events.emit(wt.created,E)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=It(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(wt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(h=>{if(h.topic===i){if(typeof n<"u"&&h.id!==n)return;this.records.delete(h.id),this.events.emit(wt.deleted,h)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Xi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(wt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(wt.created,e=>{const r=wt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(wt.updated,e=>{const r=wt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(wt.deleted,e=>{const r=wt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Zd extends qc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new lt.EventEmitter,this.name=Td,this.version=Ad,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const h=this.formatTarget(i),E={target:h,expiry:n};this.expirations.set(h,E),this.checkExpiry(h,E),this.events.emit(ft.created,{target:h,expiration:E})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),h=this.getExpiration(n);this.expirations.delete(n),this.events.emit(ft.deleted,{target:n,expiration:h})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return df(e);if(typeof e=="number")return gf(e);const{message:r}=Oe("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ft.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ft.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ft.created,e=>{const r=ft.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ft.expired,e=>{const r=ft.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ft.deleted,e=>{const r=ft.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Qd=Object.defineProperty,Cs=Object.getOwnPropertySymbols,eg=Object.prototype.hasOwnProperty,tg=Object.prototype.propertyIsEnumerable,Us=(t,e,r)=>e in t?Qd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rs=(t,e)=>{for(var r in e||(e={}))eg.call(e,r)&&Us(t,r,e[r]);if(Cs)for(var r of Cs(e))tg.call(e,r)&&Us(t,r,e[r]);return t};class ln extends Fc{constructor(e){super(e),this.protocol=Va,this.version=sd,this.name=fn,this.events=new lt.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||ad.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new Dr.HeartBeat,this.crypto=new Cd(this,this.logger,e==null?void 0:e.keychain),this.history=new Xd(this,this.logger),this.expirer=new Zd(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new _c(Rs(Rs({},od),e==null?void 0:e.storageOptions)),this.relayer=new Gd({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new Jd(this,this.logger)}static async init(e){const r=new ln(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const rg=ln;let ig=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},ng=class{constructor(e){this.client=e}};var dn={};Object.defineProperty(dn,"__esModule",{value:!0});var ka=dn.getWindowMetadata=void 0;const Fs=Ki;function sg(){let t,e;try{t=Fs.getDocumentOrThrow(),e=Fs.getLocationOrThrow()}catch{return null}function r(){const x=t.getElementsByTagName("link"),$=[];for(let N=0;N<x.length;N++){const A=x[N],q=A.getAttribute("rel");if(q&&q.toLowerCase().indexOf("icon")>-1){const F=A.getAttribute("href");if(F)if(F.toLowerCase().indexOf("https:")===-1&&F.toLowerCase().indexOf("http:")===-1&&F.indexOf("//")!==0){let B=e.protocol+"//"+e.host;if(F.indexOf("/")===0)B+=F;else{const u=e.pathname.split("/");u.pop();const b=u.join("/");B+=b+"/"+F}$.push(B)}else if(F.indexOf("//")===0){const B=e.protocol+F;$.push(B)}else $.push(F)}}return $}function i(...x){const $=t.getElementsByTagName("meta");for(let N=0;N<$.length;N++){const A=$[N],q=["itemprop","property","name"].map(F=>A.getAttribute(F)).filter(F=>F?x.includes(F):!1);if(q.length&&q){const F=A.getAttribute("content");if(F)return F}}return""}function n(){let x=i("name","og:site_name","og:title","twitter:title");return x||(x=t.title),x}function h(){return i("description","og:description","twitter:description","keywords")}const E=n(),f=h(),_=e.origin,O=r();return{description:f,url:_,icons:O,name:E}}ka=dn.getWindowMetadata=sg;var ag={};(function(t){const e=Gi,r=ki,i=Vi,n=on,h=u=>u==null,E=Symbol("encodeFragmentIdentifier");function f(u){switch(u.arrayFormat){case"index":return b=>(g,y)=>{const w=g.length;return y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),"[",w,"]"].join("")]:[...g,[v(b,u),"[",v(w,u),"]=",v(y,u)].join("")]};case"bracket":return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),"[]"].join("")]:[...g,[v(b,u),"[]=",v(y,u)].join("")];case"colon-list-separator":return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),":list="].join("")]:[...g,[v(b,u),":list=",v(y,u)].join("")];case"comma":case"separator":case"bracket-separator":{const b=u.arrayFormat==="bracket-separator"?"[]=":"=";return g=>(y,w)=>w===void 0||u.skipNull&&w===null||u.skipEmptyString&&w===""?y:(w=w===null?"":w,y.length===0?[[v(g,u),b,v(w,u)].join("")]:[[y,v(w,u)].join(u.arrayFormatSeparator)])}default:return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,v(b,u)]:[...g,[v(b,u),"=",v(y,u)].join("")]}}function _(u){let b;switch(u.arrayFormat){case"index":return(g,y,w)=>{if(b=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),!b){w[g]=y;return}w[g]===void 0&&(w[g]={}),w[g][b[1]]=y};case"bracket":return(g,y,w)=>{if(b=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),!b){w[g]=y;return}if(w[g]===void 0){w[g]=[y];return}w[g]=[].concat(w[g],y)};case"colon-list-separator":return(g,y,w)=>{if(b=/(:list)$/.exec(g),g=g.replace(/:list$/,""),!b){w[g]=y;return}if(w[g]===void 0){w[g]=[y];return}w[g]=[].concat(w[g],y)};case"comma":case"separator":return(g,y,w)=>{const s=typeof y=="string"&&y.includes(u.arrayFormatSeparator),c=typeof y=="string"&&!s&&x(y,u).includes(u.arrayFormatSeparator);y=c?x(y,u):y;const H=s||c?y.split(u.arrayFormatSeparator).map(o=>x(o,u)):y===null?y:x(y,u);w[g]=H};case"bracket-separator":return(g,y,w)=>{const s=/(\[\])$/.test(g);if(g=g.replace(/\[\]$/,""),!s){w[g]=y&&x(y,u);return}const c=y===null?[]:y.split(u.arrayFormatSeparator).map(H=>x(H,u));if(w[g]===void 0){w[g]=c;return}w[g]=[].concat(w[g],c)};default:return(g,y,w)=>{if(w[g]===void 0){w[g]=y;return}w[g]=[].concat(w[g],y)}}}function O(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function v(u,b){return b.encode?b.strict?e(u):encodeURIComponent(u):u}function x(u,b){return b.decode?r(u):u}function $(u){return Array.isArray(u)?u.sort():typeof u=="object"?$(Object.keys(u)).sort((b,g)=>Number(b)-Number(g)).map(b=>u[b]):u}function N(u){const b=u.indexOf("#");return b!==-1&&(u=u.slice(0,b)),u}function A(u){let b="";const g=u.indexOf("#");return g!==-1&&(b=u.slice(g)),b}function q(u){u=N(u);const b=u.indexOf("?");return b===-1?"":u.slice(b+1)}function F(u,b){return b.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):b.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function B(u,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),O(b.arrayFormatSeparator);const g=_(b),y=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return y;for(const w of u.split("&")){if(w==="")continue;let[s,c]=i(b.decode?w.replace(/\+/g," "):w,"=");c=c===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?c:x(c,b),g(x(s,b),c,y)}for(const w of Object.keys(y)){const s=y[w];if(typeof s=="object"&&s!==null)for(const c of Object.keys(s))s[c]=F(s[c],b);else y[w]=F(s,b)}return b.sort===!1?y:(b.sort===!0?Object.keys(y).sort():Object.keys(y).sort(b.sort)).reduce((w,s)=>{const c=y[s];return Boolean(c)&&typeof c=="object"&&!Array.isArray(c)?w[s]=$(c):w[s]=c,w},Object.create(null))}t.extract=q,t.parse=B,t.stringify=(u,b)=>{if(!u)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),O(b.arrayFormatSeparator);const g=c=>b.skipNull&&h(u[c])||b.skipEmptyString&&u[c]==="",y=f(b),w={};for(const c of Object.keys(u))g(c)||(w[c]=u[c]);const s=Object.keys(w);return b.sort!==!1&&s.sort(b.sort),s.map(c=>{const H=u[c];return H===void 0?"":H===null?v(c,b):Array.isArray(H)?H.length===0&&b.arrayFormat==="bracket-separator"?v(c,b)+"[]":H.reduce(y(c),[]).join("&"):v(c,b)+"="+v(H,b)}).filter(c=>c.length>0).join("&")},t.parseUrl=(u,b)=>{b=Object.assign({decode:!0},b);const[g,y]=i(u,"#");return Object.assign({url:g.split("?")[0]||"",query:B(q(u),b)},b&&b.parseFragmentIdentifier&&y?{fragmentIdentifier:x(y,b)}:{})},t.stringifyUrl=(u,b)=>{b=Object.assign({encode:!0,strict:!0,[E]:!0},b);const g=N(u.url).split("?")[0]||"",y=t.extract(u.url),w=t.parse(y,{sort:!1}),s=Object.assign(w,u.query);let c=t.stringify(s,b);c&&(c=`?${c}`);let H=A(u.url);return u.fragmentIdentifier&&(H=`#${b[E]?v(u.fragmentIdentifier,b):u.fragmentIdentifier}`),`${g}${c}${H}`},t.pick=(u,b,g)=>{g=Object.assign({parseFragmentIdentifier:!0,[E]:!1},g);const{url:y,query:w,fragmentIdentifier:s}=t.parseUrl(u,g);return t.stringifyUrl({url:y,query:n(w,b),fragmentIdentifier:s},g)},t.exclude=(u,b,g)=>{const y=Array.isArray(b)?w=>!b.includes(w):(w,s)=>!b(w,s);return t.pick(u,y,g)}})(ag);const og=1;function cg(){return ka()||{name:"",description:"",url:"",icons:[""]}}function Ut(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Vt(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function Xt(t){return Q.fromMiliseconds(Date.now())>=Q.toMiliseconds(t)}function Zt(t){const e=Q.toMiliseconds(t||Q.FIVE_MINUTES);let r,i,n;return{resolve:h=>{n&&r&&(clearTimeout(n),r(h))},reject:h=>{n&&i&&(clearTimeout(n),i(h))},done:()=>new Promise((h,E)=>{n=setTimeout(E,e),r=h,i=E})}}function ug(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ye(t,e){return`${t}${e?`:${e}`:""}`}function Pr(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function hg(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Pr(r.accounts))}),e}function fg(t,e){const r=[];return Object.values(t).forEach(i=>{Pr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function lg(t,e){const r=[];return Object.values(t).forEach(i=>{Pr(i.accounts).includes(e)&&r.push(...i.events)}),r}function dg(t,e){const r=Hr(t,e);if(r)throw new Error(r.message);const i={};for(const[n,h]of Object.entries(t))i[n]={methods:h.methods,events:h.events,chains:h.accounts.map(E=>`${E.split(":")[0]}:${E.split(":")[1]}`)};return i}const gg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},pg={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ee(t,e){const{message:r,code:i}=pg[t];return{message:e?`${r} ${e}`:r,code:i}}function ot(t,e){const{message:r,code:i}=gg[t];return{message:e?`${r} ${e}`:r,code:i}}function oi(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Wr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function xt(t){return typeof t>"u"}function it(t,e){return e&&xt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function gn(t,e){return e&&xt(t)?!0:typeof t=="number"&&!isNaN(t)}function yg(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let h=!0;return Ut(n,i)?(i.forEach(E=>{const{accounts:f,methods:_,events:O}=t.namespaces[E],v=Pr(f),x=r[E];(!Ut(x.chains,v)||!Ut(x.methods,_)||!Ut(x.events,O))&&(h=!1)}),h):!1}function pn(t){return it(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function _g(t){if(it(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&pn(r)}}return!1}function bg(t,e){let r=null;return it(t==null?void 0:t.publicKey,!1)||(r=ee("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function js(t){let e=!0;return oi(t)?t.length&&(e=t.every(r=>it(r,!1))):e=!1,e}function mg(t,e,r){let i=null;return oi(e)?e.forEach(n=>{i||(!pn(n)||!n.includes(t))&&(i=ot("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):i=ot("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function wg(t,e){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const h=mg(i,n==null?void 0:n.chains,`${e} requiredNamespace`);h&&(r=h)}),r}function Eg(t,e){let r=null;return oi(t)?t.forEach(i=>{r||_g(i)||(r=ot("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ot("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function vg(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Eg(i==null?void 0:i.accounts,`${e} namespace`);n&&(r=n)}),r}function Dg(t,e){let r=null;return js(t==null?void 0:t.methods)?js(t==null?void 0:t.events)||(r=ot("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ot("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Ya(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Dg(i,`${e}, namespace`);n&&(r=n)}),r}function Sg(t,e){let r=null;if(t&&Wr(t)){const i=Ya(t,e);i&&(r=i);const n=wg(t,e);n&&(r=n)}else r=ee("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function Hr(t,e){let r=null;if(t&&Wr(t)){const i=Ya(t,e);i&&(r=i);const n=vg(t,e);n&&(r=n)}else r=ee("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Wa(t){return it(t.protocol,!0)}function Og(t,e){let r=!1;return e&&!t?r=!0:t&&oi(t)&&t.length&&t.forEach(i=>{r=Wa(i)}),r}function Ig(t){return typeof t=="number"}function pt(t){return typeof t<"u"&&typeof t!==null}function xg(t){return!(!t||typeof t!="object"||!t.code||!gn(t.code,!1)||!t.message||!it(t.message,!1))}function Pg(t){return!(xt(t)||!it(t.method,!1))}function Tg(t){return!(xt(t)||xt(t.result)&&xt(t.error)||!gn(t.id,!1)||!it(t.jsonrpc,!1))}function Ag(t){return!(xt(t)||!it(t.name,!1))}function Ls(t,e){return!(!pn(e)||!hg(t).includes(e))}function Ng(t,e,r){return it(r,!1)?fg(t,e).includes(r):!1}function Cg(t,e,r){return it(r,!1)?lg(t,e).includes(r):!1}function $s(t,e,r){let i=null;const n=Object.keys(t),h=Object.keys(e);return Ut(n,h)?n.forEach(E=>{if(i)return;const f=t[E].chains,_=Pr(e[E].accounts);Ut(f,_)?Ut(t[E].methods,e[E].methods)?Ut(t[E].events,e[E].events)||(i=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${E}`)):i=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${E}`):i=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${E}`)}):i=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}function Ug(t,e){return gn(t,!1)&&t<=e.max&&t>=e.min}const Ja="wc",Xa=2,Za="client",yn=`${Ja}@${Xa}:${Za}:`,Oi={name:Za,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Rg="proposal",Fg="session",Mr=Q.SEVEN_DAYS,jg="engine",gr={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ii={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},Lg="request";var $g=Object.defineProperty,Mg=Object.defineProperties,Hg=Object.getOwnPropertyDescriptors,Ms=Object.getOwnPropertySymbols,zg=Object.prototype.hasOwnProperty,qg=Object.prototype.propertyIsEnumerable,Hs=(t,e,r)=>e in t?$g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ot=(t,e)=>{for(var r in e||(e={}))zg.call(e,r)&&Hs(t,r,e[r]);if(Ms)for(var r of Ms(e))qg.call(e,r)&&Hs(t,r,e[r]);return t},xi=(t,e)=>Mg(t,Hg(e));class Bg extends ng{constructor(e){super(e),this.name=jg,this.events=new lt,this.initialized=!1,this.ignoredPayloadTypes=[og],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(gr)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:n,relays:h}=r;let E=i,f,_=!1;if(E&&(_=this.client.core.pairing.pairings.get(E).active),!E||!_){const{topic:F,uri:B}=await this.client.core.pairing.create();E=F,f=B}const O=await this.client.core.crypto.generateKeyPair(),v={requiredNamespaces:n,relays:h??[{protocol:Ga}],proposer:{publicKey:O,metadata:this.client.metadata}},{reject:x,resolve:$,done:N}=Zt();if(this.events.once(Ye("session_connect"),async({error:F,session:B})=>{if(F)x(F);else if(B){B.self.publicKey=O;const u=xi(Ot({},B),{requiredNamespaces:B.requiredNamespaces});await this.client.session.set(B.topic,u),await this.setExpiry(B.topic,B.expiry),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:B.peer.metadata}),$(u)}}),!E){const{message:F}=ee("NO_MATCHING_KEY",`connect() pairing topic: ${E}`);throw new Error(F)}const A=await this.sendRequest(E,"wc_sessionPropose",v),q=Vt(Q.FIVE_MINUTES);return await this.setProposal(A,Ot({id:A,expiry:q},v)),{uri:f,approval:N}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:h}=r,E=this.client.proposal.get(i);let{pairingTopic:f,proposer:_,requiredNamespaces:O}=E;Wr(O)||(O=dg(h,"approve()"),this.client.proposal.set(i,xi(Ot({},E),{requiredNamespaces:O})));const v=await this.client.core.crypto.generateKeyPair(),x=_.publicKey,$=await this.client.core.crypto.generateSharedKey(v,x),N={relay:{protocol:n??"irn"},namespaces:h,requiredNamespaces:O,controller:{publicKey:v,metadata:this.client.metadata},expiry:Vt(Mr)};await this.client.core.relayer.subscribe($);const A=await this.sendRequest($,"wc_sessionSettle",N),{done:q,resolve:F,reject:B}=Zt();this.events.once(Ye("session_approve",A),({error:b})=>{b?B(b):F(this.client.session.get($))});const u=xi(Ot({},N),{topic:$,acknowledged:!1,self:N.controller,peer:{publicKey:_.publicKey,metadata:_.metadata},controller:v});return await this.client.session.set($,u),await this.setExpiry($,Vt(Mr)),f&&await this.client.core.pairing.updateMetadata({topic:f,metadata:u.peer.metadata}),f&&i&&(await this.sendResult(i,f,{relay:{protocol:n??"irn"},responderPublicKey:v}),await this.client.proposal.delete(i,ot("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f})),{topic:$,acknowledged:q}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:h}=this.client.proposal.get(i);h&&(await this.sendError(i,h,n),await this.client.proposal.delete(i,ot("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,h=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:E,resolve:f,reject:_}=Zt();return this.events.once(Ye("session_update",h),({error:O})=>{O?_(O):f()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:E}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:h,resolve:E,reject:f}=Zt();return this.events.once(Ye("session_extend",n),({error:_})=>{_?f(_):E()}),await this.setExpiry(i,Vt(Mr)),{acknowledged:h}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:h,expiry:E}=r,f=await this.sendRequest(h,"wc_sessionRequest",{request:n,chainId:i},E),{done:_,resolve:O,reject:v}=Zt(E);return this.events.once(Ye("session_request",f),({error:x,result:$})=>{x?v(x):O($)}),await _()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:h}=n;Ct(n)?await this.sendResult(h,i,n.result):It(n)&&await this.sendError(h,i,n.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:h,resolve:E,reject:f}=Zt();this.events.once(Ye("session_ping",n),({error:_})=>{_?f(_):E()}),await h()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:h}=r;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:h})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",ot("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>yg(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,ot("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,ot("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=gr.wc_sessionRequest.req.ttl,{id:n,topic:h,params:E}=r;await this.client.pendingRequest.set(n,{id:n,topic:h,params:E}),i&&this.client.core.expirer.set(n,Vt(i))},this.sendRequest=async(r,i,n,h)=>{const E=Xi(i,n),f=await this.client.core.crypto.encode(r,E),_=gr[i].req;return h&&(_.ttl=h),this.client.core.history.set(r,E),this.client.core.relayer.publish(r,f,_),E.id},this.sendResult=async(r,i,n)=>{const h=Ji(r,n),E=await this.client.core.crypto.encode(i,h),f=await this.client.core.history.get(i,r),_=gr[f.request.method].res;this.client.core.relayer.publish(i,E,_),await this.client.core.history.resolve(h)},this.sendError=async(r,i,n)=>{const h=Yi(r,n),E=await this.client.core.crypto.encode(i,h),f=await this.client.core.history.get(i,r),_=gr[f.request.method].res;this.client.core.relayer.publish(i,E,_),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Xt(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Xt(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,h=n.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,h=(await this.client.core.history.get(i,n.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:h}=i;try{this.isValidConnect(Ot({},i.params));const E=Vt(Q.FIVE_MINUTES),f=Ot({id:h,pairingTopic:r,expiry:E},n);await this.setProposal(h,f),this.client.events.emit("session_proposal",{id:h,params:f})}catch(E){await this.sendError(h,r,E),this.client.logger.error(E)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Ct(i)){const{result:h}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const E=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:E});const f=E.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:f});const _=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const O=await this.client.core.crypto.generateSharedKey(f,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:O});const v=await this.client.core.relayer.subscribe(O);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:v}),await this.client.core.pairing.activate({topic:r})}else It(i)&&(await this.client.proposal.delete(n,ot("USER_DISCONNECTED")),this.events.emit(Ye("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:h}=i;try{this.isValidSessionSettleRequest(h);const{relay:E,controller:f,expiry:_,namespaces:O,requiredNamespaces:v}=i.params,x={topic:r,relay:E,expiry:_,namespaces:O,acknowledged:!0,requiredNamespaces:v,controller:f.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:f.publicKey,metadata:f.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(Ye("session_connect"),{session:x})}catch(E){await this.sendError(n,r,E),this.client.logger.error(E)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Ct(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ye("session_approve",n),{})):It(i)&&(await this.client.session.delete(r,ot("USER_DISCONNECTED")),this.events.emit(Ye("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:h}=i;try{this.isValidUpdate(Ot({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult(h,r,!0),this.client.events.emit("session_update",{id:h,topic:r,params:n})}catch(E){await this.sendError(h,r,E),this.client.logger.error(E)}},this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;Ct(i)?this.events.emit(Ye("session_update",n),{}):It(i)&&this.events.emit(Ye("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Vt(Mr)),await this.sendResult(n,r,!0),this.client.events.emit("session_extend",{id:n,topic:r})}catch(h){await this.sendError(n,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;Ct(i)?this.events.emit(Ye("session_extend",n),{}):It(i)&&this.events.emit(Ye("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.client.events.emit("session_ping",{id:n,topic:r})}catch(h){await this.sendError(n,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{Ct(i)?this.events.emit(Ye("session_ping",n),{}):It(i)&&this.events.emit(Ye("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),this.client.core.relayer.once(et.publish,async()=>{await this.deleteSession(r)}),await this.sendResult(n,r,!0),this.client.events.emit("session_delete",{id:n,topic:r})}catch(h){await this.sendError(n,r,h),this.client.logger.error(h)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:h}=i;try{this.isValidRequest(Ot({topic:r},h)),await this.setPendingSessionRequest({id:n,topic:r,params:h}),this.client.events.emit("session_request",{id:n,topic:r,params:h})}catch(E){await this.sendError(n,r,E),this.client.logger.error(E)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;Ct(i)?this.events.emit(Ye("session_request",n),{result:i.result}):It(i)&&this.events.emit(Ye("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:h}=i;try{this.isValidEmit(Ot({topic:r},h)),this.client.events.emit("session_event",{id:n,topic:r,params:h})}catch(E){await this.sendError(n,r,E),this.client.logger.error(E)}},this.isValidConnect=async r=>{if(!pt(r)){const{message:f}=ee("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:i,requiredNamespaces:n,relays:h}=r;if(xt(i)||await this.isValidPairingTopic(i),!xt(n)&&Wr(n)===0)return;const E=Sg(n,"connect()");if(E)throw new Error(E.message);if(!Og(h,!0)){const{message:f}=ee("MISSING_OR_INVALID",`connect() relays: ${h}`);throw new Error(f)}},this.isValidApprove=async r=>{if(!pt(r))throw new Error(ee("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:h}=r;await this.isValidProposalId(i);const E=this.client.proposal.get(i),f=Hr(n,"approve()");if(f)throw new Error(f.message);const _=$s(E.requiredNamespaces,n,"update()");if(_)throw new Error(_.message);if(!it(h,!0)){const{message:O}=ee("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(O)}},this.isValidReject=async r=>{if(!pt(r)){const{message:h}=ee("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!xg(n)){const{message:h}=ee("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!pt(r)){const{message:O}=ee("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(O)}const{relay:i,controller:n,namespaces:h,expiry:E}=r;if(!Wa(i)){const{message:O}=ee("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(O)}const f=bg(n,"onSessionSettleRequest()");if(f)throw new Error(f.message);const _=Hr(h,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(Xt(E)){const{message:O}=ee("EXPIRED","onSessionSettleRequest()");throw new Error(O)}},this.isValidUpdate=async r=>{if(!pt(r)){const{message:_}=ee("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(_)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const h=this.client.session.get(i),E=Hr(n,"update()");if(E)throw new Error(E.message);const f=$s(h.requiredNamespaces,n,"update()");if(f)throw new Error(f.message)},this.isValidExtend=async r=>{if(!pt(r)){const{message:n}=ee("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!pt(r)){const{message:_}=ee("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(_)}const{topic:i,request:n,chainId:h,expiry:E}=r;await this.isValidSessionTopic(i);const{namespaces:f}=this.client.session.get(i);if(!Ls(f,h)){const{message:_}=ee("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(_)}if(!Pg(n)){const{message:_}=ee("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(_)}if(!Ng(f,h,n.method)){const{message:_}=ee("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(_)}if(E&&!Ug(E,Ii)){const{message:_}=ee("MISSING_OR_INVALID",`request() expiry: ${E}. Expiry must be a number (in seconds) between ${Ii.min} and ${Ii.max}`);throw new Error(_)}},this.isValidRespond=async r=>{if(!pt(r)){const{message:h}=ee("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!Tg(n)){const{message:h}=ee("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!pt(r)){const{message:n}=ee("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!pt(r)){const{message:f}=ee("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(f)}const{topic:i,event:n,chainId:h}=r;await this.isValidSessionTopic(i);const{namespaces:E}=this.client.session.get(i);if(!Ls(E,h)){const{message:f}=ee("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(f)}if(!Ag(n)){const{message:f}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(f)}if(!Cg(E,h,n.name)){const{message:f}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(f)}},this.isValidDisconnect=async r=>{if(!pt(r)){const{message:n}=ee("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(et.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);Wi(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ws(n)&&(await this.client.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.client.core.expirer.on(ft.expired,async e=>{const{topic:r,id:i}=ug(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,ee("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!it(e,!1)){const{message:r}=ee("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=ee("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Xt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=ee("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!it(e,!1)){const{message:r}=ee("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=ee("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Xt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=ee("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(it(e,!1)){const{message:r}=ee("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=ee("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Ig(e)){const{message:r}=ee("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=ee("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Xt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=ee("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class Kg extends ai{constructor(e,r){super(e,r,Rg,yn),this.core=e,this.logger=r}}class Vg extends ai{constructor(e,r){super(e,r,Fg,yn),this.core=e,this.logger=r}}class Gg extends ai{constructor(e,r){super(e,r,Lg,yn),this.core=e,this.logger=r}}class _n extends ig{constructor(e){super(e),this.protocol=Ja,this.version=Xa,this.name=Oi.name,this.events=new lt.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Oi.name,this.metadata=(e==null?void 0:e.metadata)||cg();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Oi.logger}));this.core=(e==null?void 0:e.core)||new rg(e),this.logger=Se.generateChildLogger(r,this.name),this.session=new Vg(this.core,this.logger),this.proposal=new Kg(this.core,this.logger),this.pendingRequest=new Gg(this.core,this.logger),this.engine=new Bg(this)}static async init(e){const r=new _n(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var bn={};Object.defineProperty(bn,"__esModule",{value:!0});bn.getWindowMetadata=void 0;const zs=Ki;function kg(){let t,e;try{t=zs.getDocumentOrThrow(),e=zs.getLocationOrThrow()}catch{return null}function r(){const x=t.getElementsByTagName("link"),$=[];for(let N=0;N<x.length;N++){const A=x[N],q=A.getAttribute("rel");if(q&&q.toLowerCase().indexOf("icon")>-1){const F=A.getAttribute("href");if(F)if(F.toLowerCase().indexOf("https:")===-1&&F.toLowerCase().indexOf("http:")===-1&&F.indexOf("//")!==0){let B=e.protocol+"//"+e.host;if(F.indexOf("/")===0)B+=F;else{const u=e.pathname.split("/");u.pop();const b=u.join("/");B+=b+"/"+F}$.push(B)}else if(F.indexOf("//")===0){const B=e.protocol+F;$.push(B)}else $.push(F)}}return $}function i(...x){const $=t.getElementsByTagName("meta");for(let N=0;N<$.length;N++){const A=$[N],q=["itemprop","property","name"].map(F=>A.getAttribute(F)).filter(F=>F?x.includes(F):!1);if(q.length&&q){const F=A.getAttribute("content");if(F)return F}}return""}function n(){let x=i("name","og:site_name","og:title","twitter:title");return x||(x=t.title),x}function h(){return i("description","og:description","twitter:description","keywords")}const E=n(),f=h(),_=e.origin,O=r();return{description:f,url:_,icons:O,name:E}}bn.getWindowMetadata=kg;var Yg={};(function(t){const e=Gi,r=ki,i=Vi,n=on,h=u=>u==null,E=Symbol("encodeFragmentIdentifier");function f(u){switch(u.arrayFormat){case"index":return b=>(g,y)=>{const w=g.length;return y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),"[",w,"]"].join("")]:[...g,[v(b,u),"[",v(w,u),"]=",v(y,u)].join("")]};case"bracket":return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),"[]"].join("")]:[...g,[v(b,u),"[]=",v(y,u)].join("")];case"colon-list-separator":return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,[v(b,u),":list="].join("")]:[...g,[v(b,u),":list=",v(y,u)].join("")];case"comma":case"separator":case"bracket-separator":{const b=u.arrayFormat==="bracket-separator"?"[]=":"=";return g=>(y,w)=>w===void 0||u.skipNull&&w===null||u.skipEmptyString&&w===""?y:(w=w===null?"":w,y.length===0?[[v(g,u),b,v(w,u)].join("")]:[[y,v(w,u)].join(u.arrayFormatSeparator)])}default:return b=>(g,y)=>y===void 0||u.skipNull&&y===null||u.skipEmptyString&&y===""?g:y===null?[...g,v(b,u)]:[...g,[v(b,u),"=",v(y,u)].join("")]}}function _(u){let b;switch(u.arrayFormat){case"index":return(g,y,w)=>{if(b=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),!b){w[g]=y;return}w[g]===void 0&&(w[g]={}),w[g][b[1]]=y};case"bracket":return(g,y,w)=>{if(b=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),!b){w[g]=y;return}if(w[g]===void 0){w[g]=[y];return}w[g]=[].concat(w[g],y)};case"colon-list-separator":return(g,y,w)=>{if(b=/(:list)$/.exec(g),g=g.replace(/:list$/,""),!b){w[g]=y;return}if(w[g]===void 0){w[g]=[y];return}w[g]=[].concat(w[g],y)};case"comma":case"separator":return(g,y,w)=>{const s=typeof y=="string"&&y.includes(u.arrayFormatSeparator),c=typeof y=="string"&&!s&&x(y,u).includes(u.arrayFormatSeparator);y=c?x(y,u):y;const H=s||c?y.split(u.arrayFormatSeparator).map(o=>x(o,u)):y===null?y:x(y,u);w[g]=H};case"bracket-separator":return(g,y,w)=>{const s=/(\[\])$/.test(g);if(g=g.replace(/\[\]$/,""),!s){w[g]=y&&x(y,u);return}const c=y===null?[]:y.split(u.arrayFormatSeparator).map(H=>x(H,u));if(w[g]===void 0){w[g]=c;return}w[g]=[].concat(w[g],c)};default:return(g,y,w)=>{if(w[g]===void 0){w[g]=y;return}w[g]=[].concat(w[g],y)}}}function O(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function v(u,b){return b.encode?b.strict?e(u):encodeURIComponent(u):u}function x(u,b){return b.decode?r(u):u}function $(u){return Array.isArray(u)?u.sort():typeof u=="object"?$(Object.keys(u)).sort((b,g)=>Number(b)-Number(g)).map(b=>u[b]):u}function N(u){const b=u.indexOf("#");return b!==-1&&(u=u.slice(0,b)),u}function A(u){let b="";const g=u.indexOf("#");return g!==-1&&(b=u.slice(g)),b}function q(u){u=N(u);const b=u.indexOf("?");return b===-1?"":u.slice(b+1)}function F(u,b){return b.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):b.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function B(u,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),O(b.arrayFormatSeparator);const g=_(b),y=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return y;for(const w of u.split("&")){if(w==="")continue;let[s,c]=i(b.decode?w.replace(/\+/g," "):w,"=");c=c===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?c:x(c,b),g(x(s,b),c,y)}for(const w of Object.keys(y)){const s=y[w];if(typeof s=="object"&&s!==null)for(const c of Object.keys(s))s[c]=F(s[c],b);else y[w]=F(s,b)}return b.sort===!1?y:(b.sort===!0?Object.keys(y).sort():Object.keys(y).sort(b.sort)).reduce((w,s)=>{const c=y[s];return Boolean(c)&&typeof c=="object"&&!Array.isArray(c)?w[s]=$(c):w[s]=c,w},Object.create(null))}t.extract=q,t.parse=B,t.stringify=(u,b)=>{if(!u)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),O(b.arrayFormatSeparator);const g=c=>b.skipNull&&h(u[c])||b.skipEmptyString&&u[c]==="",y=f(b),w={};for(const c of Object.keys(u))g(c)||(w[c]=u[c]);const s=Object.keys(w);return b.sort!==!1&&s.sort(b.sort),s.map(c=>{const H=u[c];return H===void 0?"":H===null?v(c,b):Array.isArray(H)?H.length===0&&b.arrayFormat==="bracket-separator"?v(c,b)+"[]":H.reduce(y(c),[]).join("&"):v(c,b)+"="+v(H,b)}).filter(c=>c.length>0).join("&")},t.parseUrl=(u,b)=>{b=Object.assign({decode:!0},b);const[g,y]=i(u,"#");return Object.assign({url:g.split("?")[0]||"",query:B(q(u),b)},b&&b.parseFragmentIdentifier&&y?{fragmentIdentifier:x(y,b)}:{})},t.stringifyUrl=(u,b)=>{b=Object.assign({encode:!0,strict:!0,[E]:!0},b);const g=N(u.url).split("?")[0]||"",y=t.extract(u.url),w=t.parse(y,{sort:!1}),s=Object.assign(w,u.query);let c=t.stringify(s,b);c&&(c=`?${c}`);let H=A(u.url);return u.fragmentIdentifier&&(H=`#${b[E]?v(u.fragmentIdentifier,b):u.fragmentIdentifier}`),`${g}${c}${H}`},t.pick=(u,b,g)=>{g=Object.assign({parseFragmentIdentifier:!0,[E]:!1},g);const{url:y,query:w,fragmentIdentifier:s}=t.parseUrl(u,g);return t.stringifyUrl({url:y,query:n(w,b),fragmentIdentifier:s},g)},t.exclude=(u,b,g)=>{const y=Array.isArray(b)?w=>!b.includes(w):(w,s)=>!b(w,s);return t.pick(u,y,g)}})(Yg);const Wg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Jg(t,e){const{message:r,code:i}=Wg[t];return{message:e?`${r} ${e}`:r,code:i}}function Xg(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Zg(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Ft(t,e){let r;return e.rpcMap&&(r=e.rpcMap[Qg([t])]),r}function Qg(t){return Number(t[0].split(":")[1])}class ep{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new wr(new Jr(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class tp{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new wr(new Jr(i))}}class rp{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new wr(new Jr(i))}}class ip{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new wr(new Jr(i))}}const qs="error",np="wss://relay.walletconnect.com",sp="wc",ap="universal_provider",Bs=`${sp}@${2}:${ap}:`;var op=Object.defineProperty,cp=Object.defineProperties,up=Object.getOwnPropertyDescriptors,Ks=Object.getOwnPropertySymbols,hp=Object.prototype.hasOwnProperty,fp=Object.prototype.propertyIsEnumerable,Vs=(t,e,r)=>e in t?op(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gs=(t,e)=>{for(var r in e||(e={}))hp.call(e,r)&&Vs(t,r,e[r]);if(Ks)for(var r of Ks(e))fp.call(e,r)&&Vs(t,r,e[r]);return t},lp=(t,e)=>cp(t,up(e));class mn{constructor(e){this.events=new lt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||qs}))}static async init(e){const r=new mn(e);return await r.initialize(),r}async request(e,r){const[i,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Gs({},e),chainId:`${i}:${n}`,topic:this.session.topic})}sendAsync(e,r,i){this.request(e,i).then(n=>r(null,n)).catch(n=>r(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Jg("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:r}=e;return this.setNamespaces(r),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,r){try{const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Xg(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Bs}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await _n.init({logger:this.providerOpts.logger||qs,relayUrl:this.providerOpts.relayUrl||np,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new ep({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new tp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new rp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new ip({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,r.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:n}=r,h=(i=this.client)==null?void 0:i.session.get(e);this.session=lp(Gs({},h),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Bs}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);return!r||!i?Zg(this.namespaces):[r,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r){const[i,n]=this.validateChain(r);this.getProvider(i).setDefaultChain(n),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const Ip=mn;export{Ip as UniversalProvider,mn as default};
